<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>归档：2011 - 三水清</title>
  <meta name="author" content="三水清">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="三水清"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="atom.xml" title="三水清" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">三水清</a></h1>
  <h2><a href="/">专注前端开发,分享Javascript/CSS/PHP等Web前端开发技巧</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="https://github.com/ksky521">Github</a></li>
    
      <li><a href="http://weibo.com/sanshuiqing">新浪微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title">2011</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/11/29/非字母javascript/">非字母javascript</a></h1>
  

      <time datetime="2011-11-29T10:17:03.000Z"><a href="/2011/11/29/非字母javascript/">2011年11月29日</a></time>
    </header>
    <div class="entry">
      
        <p>你尝试过写javascript不用字母和数字吗？最近准备个xss的分享，记起了之前看到过老外一篇文章，内容是关于non-alpha javascript的，拿到代码分析下。<br>先看这段猥琐的javascript代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>_=+[];$=_++;__=(_&lt;<span class="xml"><span class="tag">&lt;<span class="title">_);___=(_&lt;&lt;_)+_;____=__+__;_____=__+___;$$=({}+"")[_____]+({}+"")[_]+({}[$]+"")[_]+(($!=$)+"")[___]+(($==$)+"")[$]+(($==$)+"")[_]+(($==$)+"")[__]+({}+"")[_____]+(($==$)+"")[$]+({}+"")[_]+(($==$)+"")[_];$$$=(($!=$)+"")[_]+(($!=$)+"")[__]+(($==$)+"")[___]+(($==$)+"")[_]+(($==$)+"")[$];$_$=({}+"")[_____]+({}+"")[_]+({}+"")[_]+(($!=$)+"")[__]+({}+"")[__+_____]+({}+"")[_____]+</span> ({}+"")[<span class="attribute">_</span>]+({}[$]+"")[<span class="attribute">__</span>]+(($=<span class="value">=$)+"")[___];</span> ($)[$$][$$]($$$+"('"+$<span class="attribute">_</span>$+"')")();</span>
</pre></td></tr></table></figure>

<p>看到这里你肯定抓狂了，但是这段代码是可以运行的，运行的结果是 <code>alert(&#39;cool code&#39;);</code> 。</p>
<h2>javascript分析</h2>
<p>这段代码能够运行，原因是javascript是弱类型的脚本语言，而且语法相对松散。例如下面的javascript是正确的，而且是有出乎意料结果的：<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/29/非字母javascript/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/11/28/javascript-位运算符/">javascript 位运算符</a></h1>
  

      <time datetime="2011-11-28T10:46:09.000Z"><a href="/2011/11/28/javascript-位运算符/">2011年11月28日</a></time>
    </header>
    <div class="entry">
      
        <p>前几天看到国外人在github总结的<strong>javascript</strong>的奇巧淫技（<a href="http://t.cn/herRcq），里面对位运算提到的很多，所以来科普一下javascript的位运算。于是找到了w3cschool的这篇教程，很好很强大啊，于是就忍不住转载了……" target="_blank">http://t.cn/herRcq），里面对位运算提到的很多，所以来科普一下javascript的位运算。于是找到了w3cschool的这篇教程，很好很强大啊，于是就忍不住转载了……</a></p>
<p><strong>ECMAScript</strong> 整数有两种类型，即有符号整数（允许用正数和负数）和无符号整数（只允许用正数）。在 ECMAScript 中，所有整数字面量默认都是有符号整数，这意味着什么呢？</p>
<p>有符号整数使用 31 位表示整数的数值，用第 32 位表示整数的符号，0 表示正数，1 表示负数。数值范围从 -2147483648 到 2147483647。</p>
<p>可以以两种不同的方式存储二进制形式的有符号整数，一种用于存储正数，一种用于存储负数。正数是以真二进制形式存储的，前 31 位中的每一位都表示 2 的幂，从第 1 位（位 0）开始，表示 2<sup>0</sup>，第 2 位（位 1）表示 2<sup>1</sup>。没用到的位用 0 填充，即忽略不计。例如，下图展示的是数 18 的表示法。</p>
<p><img src="http://www.w3school.com.cn/i/ct_js_integer_binary_signed_32bits.gif" alt="32 位二进制表示的有符号整数"></p>
<p>18 的二进制版本只用了前 5 位，它们是这个数字的有效位。把数字转换成二进制字符串，就能看到有效位：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> iNum = <span class="number">18</span>;
alert(iNum.toString(<span class="number">2</span>));	<span class="comment">//输出 "10010"</span>
</pre></td></tr></table></figure>

<p>这段代码只输出 “10010”，而不是 18 的 32 位表示。其他的数位并不重要，因为仅使用前 5 位即可确定这个十进制数值。如下图所示：</p>
<p><img src="http://www.w3school.com.cn/i/ct_js_integer_binary_number18.gif" alt="5 位二进制表示的整数 18"></p>
<p>负数也存储为二进制代码，不过采用的形式是二进制补码。计算数字二进制补码的步骤有三步：</p>
<ol>
<li>确定该数字的非负版本的二进制表示（例如，要计算 -18的二进制补码，首先要确定 18 的二进制表示）</li>
<li>求得二进制反码，即要把 0 替换为 1，把 1 替换为 0</li>
<li>在二进制反码上加 1</li>
</ol>
<p>要确定 -18 的二进制表示，首先必须得到 18 的二进制表示，如下所示：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0001</span> <span class="number">0010</span>
</pre></td></tr></table></figure>

<p>接下来，计算二进制反码，如下所示：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1110</span> <span class="number">1101</span>
</pre></td></tr></table></figure>

<p>最后，在二进制反码上加 1，如下所示：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1110</span> <span class="number">1101</span>
                                      <span class="number">1</span>
---------------------------------------
<span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1111</span> <span class="number">1110</span> <span class="number">1110</span>
</pre></td></tr></table></figure>

<p>因此，-18 的二进制表示即 1111 1111 1111 1111 1111 1111 1110 1110。记住，在处理有符号整数时，开发者不能访问 31 位。</p>
<p>有趣的是，把负整数转换成二进制字符串后，ECMAScript 并不以二进制补码的形式显示，而是用数字绝对值的标准二进制代码前面加负号的形式输出。例如：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> iNum = -<span class="number">18</span>;
alert(iNum.toString(<span class="number">2</span>));	<span class="comment">//输出 "-10010"</span>
</pre></td></tr></table></figure>

<p>这段代码输出的是 “-10010”，而非二进制补码，这是为避免访问位 31。为了简便，ECMAScript 用一种简单的方式处理整数，使得开发者不必关心它们的用法。</p>
<p>另一方面，无符号整数把最后一位作为另一个数位处理。在这种模式中，第 32 位不表示数字的符号，而是值 2<sup>31</sup>。由于这个额外的位，无符号整数的数值范围为 0 到 4294967295。对于小于 2147483647 的整数来说，无符号整数看来与有符号整数一样，而大于 2147483647 的整数则要使用位 31（在有符号整数中，这一位总是 0）。</p>
<p>把无符号整数转换成字符串后，只返回它们的有效位。</p>
<p><strong>注意：</strong>所有整数字面量都默认存储为有符号整数。只有 ECMAScript 的位运算符才能创建无符号整数。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/28/javascript-位运算符/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/11/15/ie6中javascript文件开启gzip出现代码不执行情况/">IE6中javascript文件开启Gzip出现代码不执行情况</a></h1>
  

      <time datetime="2011-11-14T20:25:23.000Z"><a href="/2011/11/15/ie6中javascript文件开启gzip出现代码不执行情况/">2011年11月15日</a></time>
    </header>
    <div class="entry">
      
        <p>今天处理IE6下的一个bug，经过调试才发现是<strong>javascript</strong>文件文件总是执行不了，</p>
<p>后来中午吃完饭回来才想起以前同事遇见的html中的javascript不可以执行的问题，怀疑是gzip的原因，此次的问题就是因为动态加载javascript文件导致代码不执行，</p>
<p>经过研究发现gzip压缩过的javascript文件，如果header里Cache-Control 数据有no-cache, no-store，就会出现IE6中js代码不执行的问题。下面是转发的文章内容：</p>
<p>IE6下面调用开启了gzip压缩Javascript的时候，时常会碰到无法执行的情况，有可能是src调用，有可能是ajax调用，其它的浏览器工作正常，唯独IE6不能正常工作。<br>出现这个BUG的状况如下：</p>
<ol>
<li>用户使用IE6浏览器</li>
<li>服务器没有设置 被请求文件(javascript) expires, cache-control.</li>
<li>服务器端开启了chunked encoding模式</li>
<li>通过javascrip的src调用方式或者ajax请求javascript文件</li>
<li>有可能是通过php生成的javascript文件</li>
<li>服务器端开启了gzip压缩</li>
</ol>
<p>解决这个问题，我们要在服务器的cache-control和expires 头信息上做点工作。<br>经过测试，header头信息如下的gzip压缩过的javascript调用可以正常工作。</p>
<blockquote>
<p>Cache-Control:maxage=1<br>Connection:keep-alive<br>Content-Encoding:gzip<br>Content-Type:application/x-javascript;charset=GBK<br>Date:Wed, 01 Dec 2010 01:24:07 GMT<br>Expires:Wed, 01 Dec 2010 01:24:08 GMT<br>Pragma:public<br>Server:nginx<br>Transfer-Encoding:chunked</p>
</blockquote>
<p>分析上面的头信息，我们可以注意到：</p>
<ol>
<li>cache-control必须要设置成maxage=time的格式，maxage是指定缓存生效时间，1为1秒</li>
<li>Expires必须要设置，它的时间稍大于Date即可，Date是页面请求时间，Expires是过期时间</li>
<li>Pragma设置为public</li>
</ol>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/15/ie6中javascript文件开启gzip出现代码不执行情况/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/11/08/javascript的string-replace的妙用/">javascript的String.replace的妙用</a></h1>
  

      <time datetime="2011-11-07T19:33:54.000Z"><a href="/2011/11/08/javascript的string-replace的妙用/">2011年11月8日</a></time>
    </header>
    <div class="entry">
      
        <p>作为<strong>前端开发</strong>人员，总会有点自己的奇技淫巧，毕竟前端开发不同于后端，代码全部暴漏给用户不说，代码冗余了少则影响带宽，多则效率降低。所以今天我也来爆个自己的奇技淫巧。</p>
<p>j<strong>avascript</strong>的String.replace方法应该javascript前端开发工程师都了解，可是你掌握了吗？</p>
<p>replace有接受两个参数，第一个参数可以是字符串，也可以是正则表达式，第二个参数除支持字符串之外，还支持<code>$1</code>形式正则匹配的文本，除此之外还支持传入一个处理函数，这个函数的<code>return</code>值就是要替换成的内容。<br>了解更多javascript的String.replace用法，访问：<a href="http://www.w3school.com.cn/js/jsref_replace.asp" target="_blank">http://www.w3school.com.cn/js/jsref_replace.asp</a></p>
<h3>String.replace的妙用</h3>
<p>在《javascript获取隐藏dom的宽高》中，我就使用了replace，使用replace做一些重复性的操作，减少不必要的代码。</p>
<p>其实这里说的重复性的工作就是循环！例如，我们要获取假如我要求id为div1和div2的两个元素的宽高，一部分人会一点一点的做，先算完div1的，然后做div2的，这样你是否觉得有部分是充分的操作呢，于是可以将取宽高的函数独立出来，这样多了一个函数，而且函数只用这两次，似乎有点浪费。</p>
<p>于是一部分人想到了使用split切分字符串，然后用Array.forEach做循环。例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="string">"div1 div2"</span>.split(<span class="string">' '</span>).forEach(<span class="keyword">function</span>(a,i){
    console.log(a);
	<span class="comment">//do something</span>
})
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/08/javascript的string-replace的妙用/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/11/03/linux安装php加速器eaccelerator/">linux安装PHP加速器eAccelerator</a></h1>
  

      <time datetime="2011-11-02T22:42:53.000Z"><a href="/2011/11/03/linux安装php加速器eaccelerator/">2011年11月3日</a></time>
    </header>
    <div class="entry">
      
        <p>感慨下：做<strong>前端开发</strong>不少日子了，在前公司也使用过一段时间linux系统，对apache配置比较熟悉，可是对nginx配置还是不熟悉，毕竟自己是做前端开发的，大后端的事情还是比较排斥，以后多练习。前些日子vps到期了，换了空间，没配置好<strong>eAccelerator</strong>，本来想要朋友全权处理，可是他最近比较忙，只好自己处理了，现在将安装eAccelerator过程记录下，以后留用。</p>
<p>vps是centOS系统，php为nginx+fastcgi，nginx安装目录/usr/local/nginx，php安装目录/usr/local/php，开始在linux安装PHP加速器eAccelerator吧！</p>
<h2>预编译安装eAccelerator</h2>
<h3>安装前准备</h3>
<p>安装之前使用需要安装make和phpize，如果安装过，跳过此步骤。运行下面的命令</p>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>yum install make php5-dev
<span class="comment">#ubuntu下用apt-get</span>
</pre></td></tr></table></figure>

<h3>安装eAccelerator</h3>
<p>然后开始下载eAccelerator，配置安装编译：</p>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>wget http://bart.eaccelerator.net/source/0.9.6.1/eaccelerator-0.9.6.1.tar.bz2
tar xjf eaccelerator-0.9.6.1.tar.bz2
cd eaccelerator-0.9.6.1
/usr/bin/phpize
./configure -enable-eaccelerator=shared -with-php-config=/usr/bin/php-config
make
make install
</pre></td></tr></table></figure>

<p>这时会将eaccelerator安装到php目录中，屏幕会显示<code>eaccelerator.so</code>所在路径，例如：<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/03/linux安装php加速器eaccelerator/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/10/29/检查nginx配置，重载配置以及重启的方法/">检查nginx配置，重载配置以及重启的方法</a></h1>
  

      <time datetime="2011-10-29T10:13:47.000Z"><a href="/2011/10/29/检查nginx配置，重载配置以及重启的方法/">2011年10月29日</a></time>
    </header>
    <div class="entry">
      
        <p>一直使用apache，新的vps使用的是<strong>nginx</strong>，于是开始折腾nginx了，今天查到了检查nginx配置是否正确和重启的方法，记录下，高手飘过。我的nginx安装在/usr/local/nginx，系统为ubuntu</p>
<h2>几个常用的nginx命令</h2>
<p>Nginx 安装后只有一个程序文件，本身并不提供各种管理程序，它是使用参数和系统信号机制对 Nginx 进程本身进行控制的。 Nginx 的参数包括有如下几个：</p>
<p>可以这样使用</p>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>/usr/local/nginx/sbin/nginx  -参数
</pre></td></tr></table></figure>

<ul>
<li>-c <path_to_config>：使用指定的配置文件而不是 conf 目录下的 nginx.conf 。</li>
<li>-t：测试配置文件是否正确，在运行时需要重新加载配置的时候，此命令非常重要，用来检测所修改的配置文件是否有语法错误。</li>
<li>-s reload 重载</li>
<li>-s stop 停止</li>
</ul>
<h3>nginx启动/重启/停止</h3>
<p>这个很简单，就是运行命令：</p>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/10/29/检查nginx配置，重载配置以及重启的方法/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/10/25/javascript作用域和作用域链/">javascript作用域和作用域链</a></h1>
  

      <time datetime="2011-10-25T11:26:22.000Z"><a href="/2011/10/25/javascript作用域和作用域链/">2011年10月25日</a></time>
    </header>
    <div class="entry">
      
        <p>javascript的<strong>作用域</strong>是一个重要的知识点，javascript作用域（scope）是通过javascript的作用域链（scope chain）来实现的。</p>
<h2>javascript作用域</h2>
<p>javascript作用域(scope)：简单的说，就是创建一个函数时在什么环境下创建的，它控制了javascript代码运行时变量和函数的访问范围。在JavaScript中，变量的作用域有全局作用域和局部作用域两种。</p>
<h3>全局作用域（Global Scope）</h3>
<p>在代码中任何地方都能访问到的对象拥有全局作用域，注意：全局变量是魔鬼！因为它效率低（后面讲到），污染全局环境！一般有一下三种方式获取全局作用域。</p>
<h4>代码最外层定义的函数和变量拥有全局作用域</h4>
<p>在代码的最外层，定义的函数、变量，都是拥有全局作用域的。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">()</span>{</span>
    <span class="keyword">var</span> a = <span class="number">2</span>;
}
b();
alert(a);<span class="comment">//1</span>
</pre></td></tr></table></figure>

<h4>函数内部不使用var定义的拥有全局作用域</h4>
<p>在函数内部，不使用var定义的变量拥有全局作用域，这是个坑！要注意，很多前端开发工程师不习惯写var，其实这时候你已经污染了全局作用域！</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">()</span>{</span>
    a = <span class="number">2</span>;
    c = <span class="number">3</span>;
}
b();
alert(a);<span class="comment">//2</span>
alert(c);<span class="comment">//3</span>
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/10/25/javascript作用域和作用域链/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/10/24/正确理解javascript的this关键字/">正确理解javascript的this关键字</a></h1>
  

      <time datetime="2011-10-24T08:55:30.000Z"><a href="/2011/10/24/正确理解javascript的this关键字/">2011年10月24日</a></time>
    </header>
    <div class="entry">
      
        <p>javascript有<code>this</code>关键字，this跟<strong>javascript</strong>的执行上下文密切相关，很多前端开发工程师至今对this关键字还是模棱两可，本文将结合代码讲解下javascript的<strong>this关键字</strong>。</p>
<h2>this和对象的关系</h2>
<p>首先来看下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">var</span> person = {
	name:<span class="string">'Theo Wong'</span>,
	gender:<span class="string">'male'</span>,
	getName:<span class="keyword">function</span>(){
		console.log(person.name);
	}
};
person.getName();
</pre></td></tr></table></figure>

<p>定义了一个person对象，对象中包含了name、gender属性，还包括了一个getName的方法，其作用是输出person对象的name。在这种情况下，我们可以使用this来在person对象中代替person对象本身，所以上面的代码跟下面的直接结果是一样的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">var</span> person = {
	name:<span class="string">'Theo Wong'</span>,
	gender:<span class="string">'male'</span>,
	getName:<span class="keyword">function</span>(){
		console.log(<span class="keyword">this</span>.name);
	}
};
person.getName();
</pre></td></tr></table></figure>

<p>请记住一点：<strong>this永远指向的是函数对象的所有者</strong>！上面的例子中getName的所有者是person对象，所以this指代的是person。</p>
<h2>this和全局对象</h2>
<p>我们再来看看再全局对象中，this指代的是什么，我们知道javascript是脚本语言，所以javascript的执行需要有一个宿主环境，在浏览器中这个宿主环境就是window对象，所以在全局函数中，this指代的是window对象（除非使用new，call，apply方法来改变this的指代关系）。懂得了这个关键点，下面的代码就好理解了：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="number">1</span>;
console.log(a);<span class="comment">//1</span>
console.log(<span class="keyword">this</span>.a);<span class="comment">//1</span>
console.log(window.a);<span class="comment">//1</span>
</pre></td></tr></table></figure>

<p>很多<strong>前端开发</strong>工程师经常使用在函数名字之前添加个window来调用函数，这是因为在浏览器中全局对象就是window，所有的函数变量都是在window对象之中，所以下面的代码中的this指代window对象就好理解了：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>
	<span class="keyword">var</span> b = <span class="number">2</span>;
	console.log(<span class="keyword">this</span>.a+b);<span class="comment">//3</span>
}
foo();
</pre></td></tr></table></figure>

<p>所以说，只要记住：<strong>this</strong>永远指向的是函数对象的所有者，即this的值是由激活执行上下文代码的调用者决定的，就好理解this的指代关系了。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/10/24/正确理解javascript的this关键字/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/10/23/chrome扩展应用开发教程之调试和打包上线/">chrome扩展应用开发教程之调试和打包上线</a></h1>
  

      <time datetime="2011-10-23T09:10:02.000Z"><a href="/2011/10/23/chrome扩展应用开发教程之调试和打包上线/">2011年10月23日</a></time>
    </header>
    <div class="entry">
      
        <p>今天的文章来说说chrome扩展开发的最后一步，代码调试和打包上线。</p>
<h2>chrome应用代码调试</h2>
<p>跟<strong>前端开发</strong>一样，chrome应用开发过程中也是需要代码调试的，用的调试工具自然是chrome的开发者工具，所以前端开发工程师应该很快就可以上手！</p>
<p>代码调试需要调出来chrome的扩展程序页面，有三种方式调出来chrome的扩展程序页面</p>
<ol>
<li>chrome右上角“扳手图标”→工具→扩展程序</li>
<li>新开个chrome选项卡，然后在地址栏输入：chrome://extensions/回车</li>
<li>右键点击某个扩展，选择管理扩展程序<br>这样就会看到如下的扩展程序界面：<br><a href="/uploads/2011/10/2011-10-22_124540-300x179.png"><img src="/uploads/2011/10/2011-10-22_124540-300x179.png" alt="chrome扩展程序界面" title="chrome扩展程序界面"></a></li>
</ol>
<p>点击右上角的“开发者模式”，就会出现三个按钮，选择“载入正在开发中的扩展程序…”，在新开的窗口中找到自己开发的程序的路径，然后打开就可以导入开发中的chrome应用了。点击活动视窗，就可以打开chrome的开发中工具，前端开发工程师就可以进行调试了，跟调试前端页面一样哦。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/10/23/chrome扩展应用开发教程之调试和打包上线/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/10/22/chrome扩展应用开发教程之天气预报应用开发/">chrome扩展应用开发教程之天气预报应用开发</a></h1>
  

      <time datetime="2011-10-22T12:14:24.000Z"><a href="/2011/10/22/chrome扩展应用开发教程之天气预报应用开发/">2011年10月22日</a></time>
    </header>
    <div class="entry">
      
        <p>上一篇讲到了<strong>chrome应用开发</strong>的基础知识，这一篇通过周末天气预报插件的开发来讲解下chrome扩展应用的开发过程。熟悉前端开发的童靴，知道了chrome应用开发的基本配置，应该很快就可以开发一个chrome应用，因为chrome插件就是纯粹的javascript和html！</p>
<h2>开发前的准备</h2>
<p>在开发之前需要统筹下，chrome天气预报插件的基本功能和界面，本插件，会这chrome顶部添加一个带有当前天气icon的应用，点击应用打开弹窗页面，天气的数据来自weather.com.cn的接口，所以我们需要跨域授权应用可以请求weather.com.cn的数据。于是chrome天气预报插件的manifest.json部分代码就出来了：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>{
  <span class="string">"name"</span>: <span class="string">"Chrome Weather"</span>, <span class="comment">//name</span>
  <span class="string">"version"</span>: <span class="string">"0.1.0"</span>, <span class="comment">//version</span>
  <span class="string">"description"</span>: <span class="string">"weather."</span>, <span class="comment">//description</span>
  <span class="string">"background_page"</span>: <span class="string">"background.html"</span>,<span class="comment">//背景页面，应用请求数据，处理icon显示实时气温</span>
  <span class="string">"browser_action"</span>: {
    <span class="string">"default_icon"</span>: <span class="string">"icon.png"</span> ,<span class="comment">//默认的icon</span>
    <span class="string">"default_title"</span>: <span class="string">"Weather"</span>,<span class="comment">//默认鼠标overtitle</span>
    <span class="string">"default_popup"</span>: <span class="string">"popup.html"</span><span class="comment">//弹窗页面</span>
  },
	<span class="string">"permissions"</span>: [ <span class="string">"tabs"</span>, <span class="string">"http://*.weather.com.cn/"</span> ]<span class="comment">//跨域请求授权</span>
}
</pre></td></tr></table></figure>

<p>先来个最终效果截图：<br><a href="/uploads/2011/10/2011-10-22_124856-300x80.png"><img src="/uploads/2011/10/2011-10-22_124856-300x80.png" alt="chrome天气预报应用最终效果截图" title="chrome天气预报应用最终效果截图"></a></p>
<h2>通过背景页面来请求天气数据</h2>
<p>chrome天气插件用到了weather.com.cn的三个接口：</p>
<ol>
<li>根据ip获取当前用户所在城市天气编号：<a href="http://61.4.185.48:81/g/" target="_blank">http://61.4.185.48:81/g/</a></li>
<li>根据城市天气编号获取五天内天气：<a href="http://m.weather.com.cn/data/&#39;+id+&#39;.html" target="_blank">http://m.weather.com.cn/data/&#39;+id+&#39;.html</a></li>
<li>根据城市天气编号获取实时天气：<a href="http://www.weather.com.cn/data/sk/&#39;+id+&#39;.html" target="_blank">http://www.weather.com.cn/data/sk/&#39;+id+&#39;.html</a><br>chrome天气插件使用了jQuery开发，所以我们需要在html的头部添加jquery库：<br><pre lang="html"><br><script type="text/javascript" src="js/jquery.min.js"></script><figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>
<span class="comment">### 根据ip获取当前用户所在城市</span>

当用户第一次运行chrome时候，需要请求背景页面，即background.html，这时，我们需要请求接口来获取当前用户所在的城市信息，以根据cityid获取天气情况。代码如下：
```javascript
<span class="variable">$.</span>getScript(<span class="string">'http://61.4.185.48:81/g/'</span>,function(){
	window.localStorage.cityid = id;<span class="regexp">//</span>保存cityid到localStorage
	getWeather(id);<span class="regexp">//</span>获取天气信息
});
</pre></td></tr></table></figure>

</li>
</ol>
<h3>根据cityid获取天气信息</h3>
<p>上一步，涉及到了一个函数getWeather，这个函数的作用就是做一个xmlHttpRequest请求，获取当前cityid的天气信息，包括实时天气。getWeather中运用了send函数来做xmlHttpRequest请求。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getWeather</span><span class="params">(id)</span>{</span>
	<span class="keyword">var</span> url = <span class="string">'http://m.weather.com.cn/data/'</span>+id+<span class="string">'.html'</span>;
	<span class="keyword">var</span> url2 = <span class="string">'http://www.weather.com.cn/data/sk/'</span>+id+<span class="string">'.html'</span>;
	send(url,<span class="keyword">function</span>(json){
		json0 = json;
		window.localStorage.json0 = JSON.stringify(json);
		doit++;
		deal();<span class="comment">//处理json0</span>
	}).call(<span class="keyword">this</span>,url2,<span class="keyword">function</span>(json){
		json1 = json;
		window.localStorage.json1 = JSON.stringify(json);
		doit++;
		deal();<span class="comment">//处理json1</span>
	});

}
<span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(url,cb)</span>{</span>
	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
	xhr.open(<span class="string">"GET"</span>, url, <span class="literal">true</span>);
	xhr.onreadystatechange = <span class="keyword">function</span>() {
	  <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) {
		<span class="keyword">var</span> json = JSON.parse(xhr.responseText);<span class="comment">//解析json，保证安全性</span>
		<span class="keyword">typeof</span> cb===<span class="string">'function'</span> && json.weatherinfo && cb(json.weatherinfo);
		xhr = <span class="literal">null</span>;
	  }
	}
	xhr.send();
	<span class="keyword">return</span> arguments.callee;
}
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/10/22/chrome扩展应用开发教程之天气预报应用开发/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
    <a href="/archives/2011/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/乱七八糟/">乱七八糟</a><small>30</small></li>
  
    <li><a href="/categories/前端开发/">前端开发</a><small>117</small></li>
  
    <li><a href="/categories/后端运维/">后端运维</a><small>27</small></li>
  
    <li><a href="/categories/王婆卖瓜/">王婆卖瓜</a><small>4</small></li>
  
    <li><a href="/categories/读书笔记/">读书笔记</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签</h3>
  <ul class="entry clearfix">
  
    <li><a href="/tags/DOM/">DOM<sup>2</sup></a></li>
  
    <li><a href="/tags/IE/">IE<sup>1</sup></a></li>
  
    <li><a href="/tags/IE6/">IE6<sup>2</sup></a></li>
  
    <li><a href="/tags/PPT/">PPT<sup>3</sup></a></li>
  
    <li><a href="/tags/VPS/">VPS<sup>1</sup></a></li>
  
    <li><a href="/tags/ajax/">ajax<sup>5</sup></a></li>
  
    <li><a href="/tags/apache/">apache<sup>1</sup></a></li>
  
    <li><a href="/tags/audio/">audio<sup>2</sup></a></li>
  
    <li><a href="/tags/a标签/">a标签<sup>1</sup></a></li>
  
    <li><a href="/tags/canvas/">canvas<sup>1</sup></a></li>
  
    <li><a href="/tags/chrome/">chrome<sup>3</sup></a></li>
  
    <li><a href="/tags/css/">css<sup>15</sup></a></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator<sup>1</sup></a></li>
  
    <li><a href="/tags/ecmascript/">ecmascript<sup>3</sup></a></li>
  
    <li><a href="/tags/escape/">escape<sup>1</sup></a></li>
  
    <li><a href="/tags/event/">event<sup>1</sup></a></li>
  
    <li><a href="/tags/express/">express<sup>1</sup></a></li>
  
    <li><a href="/tags/fis/">fis<sup>1</sup></a></li>
  
    <li><a href="/tags/fisp/">fisp<sup>1</sup></a></li>
  
    <li><a href="/tags/grunt/">grunt<sup>1</sup></a></li>
  
    <li><a href="/tags/handleEvent/">handleEvent<sup>1</sup></a></li>
  
    <li><a href="/tags/html5/">html5<sup>3</sup></a></li>
  
    <li><a href="/tags/iframe/">iframe<sup>1</sup></a></li>
  
    <li><a href="/tags/iptables/">iptables<sup>1</sup></a></li>
  
    <li><a href="/tags/javascript/">javascript<sup>79</sup></a></li>
  
    <li><a href="/tags/linux/">linux<sup>4</sup></a></li>
  
    <li><a href="/tags/livereload/">livereload<sup>1</sup></a></li>
  
    <li><a href="/tags/memcached/">memcached<sup>1</sup></a></li>
  
    <li><a href="/tags/mixjs/">mixjs<sup>1</sup></a></li>
  
    <li><a href="/tags/mysql/">mysql<sup>2</sup></a></li>
  
    <li><a href="/tags/name/">name<sup>1</sup></a></li>
  
    <li><a href="/tags/nginx/">nginx<sup>2</sup></a></li>
  
    <li><a href="/tags/nodejs/">nodejs<sup>7</sup></a></li>
  
    <li><a href="/tags/php/">php<sup>19</sup></a></li>
  
    <li><a href="/tags/session/">session<sup>1</sup></a></li>
  
    <li><a href="/tags/storage/">storage<sup>1</sup></a></li>
  
    <li><a href="/tags/svn/">svn<sup>1</sup></a></li>
  
    <li><a href="/tags/this/">this<sup>1</sup></a></li>
  
    <li><a href="/tags/ueditor/">ueditor<sup>1</sup></a></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs<sup>1</sup></a></li>
  
    <li><a href="/tags/webbench/">webbench<sup>1</sup></a></li>
  
    <li><a href="/tags/websocket/">websocket<sup>1</sup></a></li>
  
    <li><a href="/tags/web前端开发/">web前端开发<sup>5</sup></a></li>
  
    <li><a href="/tags/windows7技巧/">windows7技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/wordpress/">wordpress<sup>3</sup></a></li>
  
    <li><a href="/tags/xss/">xss<sup>3</sup></a></li>
  
    <li><a href="/tags/严格模式/">严格模式<sup>1</sup></a></li>
  
    <li><a href="/tags/位运算/">位运算<sup>1</sup></a></li>
  
    <li><a href="/tags/作用域/">作用域<sup>3</sup></a></li>
  
    <li><a href="/tags/前端优化/">前端优化<sup>1</sup></a></li>
  
    <li><a href="/tags/前端工具/">前端工具<sup>5</sup></a></li>
  
    <li><a href="/tags/加速器/">加速器<sup>1</sup></a></li>
  
    <li><a href="/tags/压力测试/">压力测试<sup>1</sup></a></li>
  
    <li><a href="/tags/右键/">右键<sup>1</sup></a></li>
  
    <li><a href="/tags/安全/">安全<sup>1</sup></a></li>
  
    <li><a href="/tags/性能/">性能<sup>3</sup></a></li>
  
    <li><a href="/tags/我也八卦/">我也八卦<sup>1</sup></a></li>
  
    <li><a href="/tags/执行环境/">执行环境<sup>1</sup></a></li>
  
    <li><a href="/tags/技巧/">技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/播放器/">播放器<sup>1</sup></a></li>
  
    <li><a href="/tags/数组/">数组<sup>1</sup></a></li>
  
    <li><a href="/tags/标签/">标签<sup>1</sup></a></li>
  
    <li><a href="/tags/模块化/">模块化<sup>2</sup></a></li>
  
    <li><a href="/tags/算法/">算法<sup>1</sup></a></li>
  
    <li><a href="/tags/网络技术/">网络技术<sup>73</sup></a></li>
  
    <li><a href="/tags/虚拟主机/">虚拟主机<sup>1</sup></a></li>
  
    <li><a href="/tags/解耦/">解耦<sup>1</sup></a></li>
  
    <li><a href="/tags/语法限制/">语法限制<sup>1</sup></a></li>
  
    <li><a href="/tags/跨域/">跨域<sup>3</sup></a></li>
  
    <li><a href="/tags/路径/">路径<sup>1</sup></a></li>
  
    <li><a href="/tags/软件心得/">软件心得<sup>3</sup></a></li>
  
  </ul>
</div>



  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 三水清
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


    
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6635976" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
        </script>
    
    



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




    <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1c76f5cc8274a56106b13b9c9b1fb046' type='text/javascript'%3E%3C/script%3E"));
    </script>


</body>
</html>