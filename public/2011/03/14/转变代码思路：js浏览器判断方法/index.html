<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>转变代码思路：js浏览器判断方法 - 三水清</title>
  <meta name="author" content="三水清">
  
  <meta name="description" content="“变则通，通则达”，在coding的时候也要做到，有时候思路往往太过于局限性，对浏览器判断方法的实例，来说说代码思路的转变。
navigator.userAgent分析
关于javascript对浏览器的判断，很早之前我写过一篇文章《js判断浏览器的函数，可区分chrome，safari\》。
YQ框架中也是采用的这个方法，可是后来想到了有位网友说判断火狐的版本号会错误，这是因为火狐的version的判断走了正则，而没有考虑到firefox的，其实不止firefox有这个bug。
首先来看看火狐的navigator.userAgent:这个是我的firefox（3.6.15，却显示3.6.8，不知何解，查看关于也是这个问题：版本不统一）

Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 QQDownload/1.7

根据正则的写法，火狐的版本号应该这样写/Firefox[\/]([\w.]+)/而safari的确是类似的：

……Version/3.1 Safari/525.13

其中Version为实际的版本号，也是我们常称呼的版本号。
琢磨
开始写js判断浏览器的，跟jQuery的$.browser一样，可是版本号会出现问题，只不过是加了个chrome判断而已。开始想解决方法，初步想得是通过一个正则对象把浏览器的名称和版本号统一匹配出来，正则对象设置如下：
1
2
3
4
5
6
7
var browserRegExp = {
    ie:/(msie)[ ]([\w.]+)/,
    firefox:/(firefox)[ |\/]([\w.]+)/,
    chrome:/(chrome)[ |\/]([\w.]+)/,
    safari:/version[ |\/]([\w.]+)[ ](safari)/,
    opera:/(opera)[ |\/]([\w.]+)/
}">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="转变代码思路：js浏览器判断方法"/>
  <meta property="og:site_name" content="三水清"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="atom.xml" title="三水清" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">三水清</a></h1>
  <h2><a href="/">专注前端开发,分享Javascript/CSS/PHP等Web前端开发技巧</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="https://github.com/ksky521">Github</a></li>
    
      <li><a href="http://weibo.com/sanshuiqing">新浪微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon icon-black"></div>
      
      
  
    <h1 class="title">转变代码思路：js浏览器判断方法</h1>
  

      <time datetime="2011-03-14T13:04:05.000Z"><a href="/2011/03/14/转变代码思路：js浏览器判断方法/">2011年3月14日</a></time>
    </header>
    <div class="entry">
      
        <p>“变则通，通则达”，在coding的时候也要做到，有时候思路往往太过于局限性，对<strong>浏览器判断</strong>方法的实例，来说说代码思路的转变。</p>
<h3>navigator.userAgent分析</h3>
<p>关于<strong>javascript</strong>对浏览器的判断，很早之前我写过一篇文章《js判断浏览器的函数，可区分chrome，safari\》。</p>
<p>YQ框架中也是采用的这个方法，可是后来想到了有位网友说判断火狐的版本号会错误，这是因为火狐的version的判断走了正则，而没有考虑到firefox的，其实不止firefox有这个bug。</p>
<p>首先来看看火狐的<code>navigator.userAgent</code>:<br>这个是我的firefox（3.6.15，却显示3.6.8，不知何解，查看关于也是这个问题：版本不统一）</p>
<blockquote>
<p>Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 QQDownload/1.7</p>
</blockquote>
<p>根据正则的写法，火狐的版本号应该这样写<code>/Firefox[\/]([\w.]+)/</code><br>而safari的确是类似的：</p>
<blockquote>
<p>……Version/3.1 Safari/525.13</p>
</blockquote>
<p>其中Version为实际的版本号，也是我们常称呼的版本号。</p>
<h3>琢磨</h3>
<p>开始写js判断浏览器的，跟jQuery的<strong>$.browser</strong>一样，可是版本号会出现问题，只不过是加了个chrome判断而已。开始想解决方法，初步想得是通过一个正则对象把浏览器的名称和版本号统一匹配出来，正则对象设置如下：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="keyword">var</span> browserRegExp = {
    ie:<span class="regexp">/(msie)[ ]([\w.]+)/</span>,
    firefox:<span class="regexp">/(firefox)[ |\/]([\w.]+)/</span>,
    chrome:<span class="regexp">/(chrome)[ |\/]([\w.]+)/</span>,
    safari:<span class="regexp">/version[ |\/]([\w.]+)[ ](safari)/</span>,
    opera:<span class="regexp">/(opera)[ |\/]([\w.]+)/</span>
}
</pre></td></tr></table></figure>

<p><a id="more"></a><br>这个对象的设计还是有一定技巧的（后面提到），因为我后面要使用一个遍历，把全部的正则匹配一遍，生成一个类似$.browser的对象。但是仔细想想，我们在使用判断的时候怎么使用呢？无非是下面的使用：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$.browser.msie&&$.browser.version===<span class="string">'6.0'</span>
</pre></td></tr></table></figure>

<h4>第一次转变，使用方法的转变</h4>
<p>上面的使用方法，可是转变为下面的使用方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$.browser===<span class="string">'msie'</span>&&$.browserVersion===<span class="string">'6.0'</span>
</pre></td></tr></table></figure>

<p>$.browser为浏览器的名称，<code>$</code>.browserVersion为版本号，这样就不用使用的时候每次都走正则判断，提高了效率。</p>
<h4>第二次转变，函数写法的转变</h4>
<p>根据上面的分析，我们需要先判断出来浏览器名称和版本号，然后分别给$.browser、$.browserVersion赋值，于是有了下的YQ代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> browserRegExp){
        <span class="keyword">var</span> match = browserRegExp[i].exec(ua);
        <span class="keyword">if</span>(match){
            YQ.browser = match[<span class="number">1</span>];
            YQ.browserVersion = match[<span class="number">2</span>];
            <span class="keyword">break</span>;
        }
    }
</pre></td></tr></table></figure>

<p>前面提到了小技巧，就是把用户群体大浏览器放在前面，减少循环次数，IE在国内肯定是第一啦，其次FF，chrome……依次下来。</p>
<h4>第三次转变：不知道咋说了</h4>
<p>细心的童鞋应该看到了safari判断出来YQ.browser和YQ.browserVersion是相反的，要解决这个问题，就来了第三次转变！语文不好，不知道咋说这次转变了，直接上代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="keyword">var</span> ua = navigator.userAgent.toLowerCase(),
    browserRegExp = {
        ie:<span class="regexp">/msie[ ]([\w.]+)/</span>,
        firefox:<span class="regexp">/firefox[ |\/]([\w.]+)/</span>,
        chrome:<span class="regexp">/chrome[ |\/]([\w.]+)/</span>,
        safari:<span class="regexp">/version[ |\/]([\w.]+)[ ]safari/</span>,
        opera:<span class="regexp">/opera[ |\/]([\w.]+)/</span>
    };
YQ.browser = <span class="string">'unknow'</span>;
YQ.browserVersion = <span class="string">'0'</span>;
<span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> browserRegExp){
    <span class="keyword">var</span> match = browserRegExp[i].exec(ua);
    <span class="keyword">if</span>(match){
        YQ.browser = i;
        YQ.browserVersion = match[<span class="number">1</span>];
        <span class="keyword">break</span>;
    }
}
alert(YQ.browser);
alert(YQ.browserVersion);
</pre></td></tr></table></figure>

<ol>
<li>修改了正则，判断是version</li>
<li>2、判断出来是把i赋值给YQ.browser<br>这样，我们获得的YQ.browser 就是对象的key，如果IE则YQ.browser 为ie，而不是msie，实际上更加方便记忆了，而且不用多余的判断来处理safari版本号和名称倒置的问题了。</li>
</ol>
<h3>总结</h3>
<p>仔细观察多想多看会有不少发现的，我有代码洁癖，能少写判断就少写，能少用循环就少用！呵呵。<br>继续coding YQ……（状态：爱墙写完了，YQ正在检查ing）</p>

      
    </div>
    <footer>
      
        


        
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
<span class="bds_more">分享到：</span>
<a class="bds_tsina">新浪微博</a>
<a class="bds_qzone">QQ空间</a>
<a class="bds_tqq">腾讯微博</a>
<a class="bds_renren">人人网</a>
<a class="bds_douban">豆瓣网</a>
<a class="bds_bdhome">百度首页</a>
<a class="bds_youdao">有道云笔记</a>
<a class="bds_copy">复制网址</a>
</div>
<script>
var bds_config = {
    wbUid:'2037334587',
    tsina: '61439547',
    pic:''
};
</script>



        <div class="pagepart clearfix">
 
	<a href="/2011/03/15/html5css3版的爱墙上了/" class="prev" title="html5+css3版的爱墙上了">html5+css3版的爱墙上了</a>
 
 
	<a href="/2011/03/14/自己写的一个轻量级javascript框架的设计模式/" class="next" title="自己写的一个轻量级javascript框架的设计模式">自己写的一个轻量级javascript框架的设计模式</a>
 
</div>
      
      
<div class="border"></div>
<section class="comment">
    <p class="title ico-comment">文章评论<a name="comments"></a></p>
    <div class="ds-thread" data-title="转变代码思路：js浏览器判断方法"></div>
</section>


      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/乱七八糟/">乱七八糟</a><small>30</small></li>
  
    <li><a href="/categories/前端开发/">前端开发</a><small>116</small></li>
  
    <li><a href="/categories/后端运维/">后端运维</a><small>27</small></li>
  
    <li><a href="/categories/王婆卖瓜/">王婆卖瓜</a><small>4</small></li>
  
    <li><a href="/categories/读书笔记/">读书笔记</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签</h3>
  <ul class="entry clearfix">
  
    <li><a href="/tags/DOM/">DOM<sup>2</sup></a></li>
  
    <li><a href="/tags/IE/">IE<sup>1</sup></a></li>
  
    <li><a href="/tags/IE6/">IE6<sup>2</sup></a></li>
  
    <li><a href="/tags/PPT/">PPT<sup>3</sup></a></li>
  
    <li><a href="/tags/VPS/">VPS<sup>1</sup></a></li>
  
    <li><a href="/tags/ajax/">ajax<sup>5</sup></a></li>
  
    <li><a href="/tags/apache/">apache<sup>1</sup></a></li>
  
    <li><a href="/tags/audio/">audio<sup>2</sup></a></li>
  
    <li><a href="/tags/a标签/">a标签<sup>1</sup></a></li>
  
    <li><a href="/tags/canvas/">canvas<sup>1</sup></a></li>
  
    <li><a href="/tags/chrome/">chrome<sup>3</sup></a></li>
  
    <li><a href="/tags/css/">css<sup>15</sup></a></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator<sup>1</sup></a></li>
  
    <li><a href="/tags/ecmascript/">ecmascript<sup>3</sup></a></li>
  
    <li><a href="/tags/escape/">escape<sup>1</sup></a></li>
  
    <li><a href="/tags/event/">event<sup>1</sup></a></li>
  
    <li><a href="/tags/express/">express<sup>1</sup></a></li>
  
    <li><a href="/tags/grunt/">grunt<sup>1</sup></a></li>
  
    <li><a href="/tags/handleEvent/">handleEvent<sup>1</sup></a></li>
  
    <li><a href="/tags/html5/">html5<sup>3</sup></a></li>
  
    <li><a href="/tags/iframe/">iframe<sup>1</sup></a></li>
  
    <li><a href="/tags/iptables/">iptables<sup>1</sup></a></li>
  
    <li><a href="/tags/javascript/">javascript<sup>79</sup></a></li>
  
    <li><a href="/tags/linux/">linux<sup>4</sup></a></li>
  
    <li><a href="/tags/livereload/">livereload<sup>1</sup></a></li>
  
    <li><a href="/tags/memcached/">memcached<sup>1</sup></a></li>
  
    <li><a href="/tags/mixjs/">mixjs<sup>1</sup></a></li>
  
    <li><a href="/tags/mysql/">mysql<sup>2</sup></a></li>
  
    <li><a href="/tags/name/">name<sup>1</sup></a></li>
  
    <li><a href="/tags/nginx/">nginx<sup>2</sup></a></li>
  
    <li><a href="/tags/nodejs/">nodejs<sup>7</sup></a></li>
  
    <li><a href="/tags/php/">php<sup>19</sup></a></li>
  
    <li><a href="/tags/session/">session<sup>1</sup></a></li>
  
    <li><a href="/tags/storage/">storage<sup>1</sup></a></li>
  
    <li><a href="/tags/svn/">svn<sup>1</sup></a></li>
  
    <li><a href="/tags/this/">this<sup>1</sup></a></li>
  
    <li><a href="/tags/ueditor/">ueditor<sup>1</sup></a></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs<sup>1</sup></a></li>
  
    <li><a href="/tags/webbench/">webbench<sup>1</sup></a></li>
  
    <li><a href="/tags/websocket/">websocket<sup>1</sup></a></li>
  
    <li><a href="/tags/web前端开发/">web前端开发<sup>5</sup></a></li>
  
    <li><a href="/tags/windows7技巧/">windows7技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/wordpress/">wordpress<sup>3</sup></a></li>
  
    <li><a href="/tags/xss/">xss<sup>3</sup></a></li>
  
    <li><a href="/tags/严格模式/">严格模式<sup>1</sup></a></li>
  
    <li><a href="/tags/位运算/">位运算<sup>1</sup></a></li>
  
    <li><a href="/tags/作用域/">作用域<sup>3</sup></a></li>
  
    <li><a href="/tags/前端优化/">前端优化<sup>1</sup></a></li>
  
    <li><a href="/tags/前端工具/">前端工具<sup>4</sup></a></li>
  
    <li><a href="/tags/加速器/">加速器<sup>1</sup></a></li>
  
    <li><a href="/tags/压力测试/">压力测试<sup>1</sup></a></li>
  
    <li><a href="/tags/右键/">右键<sup>1</sup></a></li>
  
    <li><a href="/tags/安全/">安全<sup>1</sup></a></li>
  
    <li><a href="/tags/性能/">性能<sup>3</sup></a></li>
  
    <li><a href="/tags/我也八卦/">我也八卦<sup>1</sup></a></li>
  
    <li><a href="/tags/执行环境/">执行环境<sup>1</sup></a></li>
  
    <li><a href="/tags/技巧/">技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/播放器/">播放器<sup>1</sup></a></li>
  
    <li><a href="/tags/数组/">数组<sup>1</sup></a></li>
  
    <li><a href="/tags/标签/">标签<sup>1</sup></a></li>
  
    <li><a href="/tags/模块化/">模块化<sup>2</sup></a></li>
  
    <li><a href="/tags/算法/">算法<sup>1</sup></a></li>
  
    <li><a href="/tags/网络技术/">网络技术<sup>73</sup></a></li>
  
    <li><a href="/tags/虚拟主机/">虚拟主机<sup>1</sup></a></li>
  
    <li><a href="/tags/解耦/">解耦<sup>1</sup></a></li>
  
    <li><a href="/tags/语法限制/">语法限制<sup>1</sup></a></li>
  
    <li><a href="/tags/跨域/">跨域<sup>3</sup></a></li>
  
    <li><a href="/tags/路径/">路径<sup>1</sup></a></li>
  
    <li><a href="/tags/软件心得/">软件心得<sup>3</sup></a></li>
  
  </ul>
</div>



  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 三水清
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


    
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6635976" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
        </script>
    
    
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"ksky521"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'http://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




    <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1c76f5cc8274a56106b13b9c9b1fb046' type='text/javascript'%3E%3C/script%3E"));
    </script>


</body>
</html>