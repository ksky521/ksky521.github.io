<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>chrome扩展应用开发教程之天气预报应用开发 - 三水清</title>
  <meta name="author" content="三水清">
  
  <meta name="description" content="上一篇讲到了chrome应用开发的基础知识，这一篇通过周末天气预报插件的开发来讲解下chrome扩展应用的开发过程。熟悉前端开发的童靴，知道了chrome应用开发的基本配置，应该很快就可以开发一个chrome应用，因为chrome插件就是纯粹的javascript和html！
开发前的准备
在开发之前需要统筹下，chrome天气预报插件的基本功能和界面，本插件，会这chrome顶部添加一个带有当前天气icon的应用，点击应用打开弹窗页面，天气的数据来自weather.com.cn的接口，所以我们需要跨域授权应用可以请求weather.com.cn的数据。于是chrome天气预报插件的manifest.json部分代码就出来了：
1
2
3
4
5
6
7
8
9
10
11
12
{
  &quot;name&quot;: &quot;Chrome Weather&quot;, //name
  &quot;version&quot;: &quot;0.1.0&quot;, //version
  &quot;description&quot;: &quot;weather.&quot;, //description
  &quot;background_page&quot;: &quot;background.html&quot;,//背景页面，应用请求数据，处理icon显示实时气温
  &quot;browser_action&quot;: {
    &quot;default_icon&quot;: &quot;icon.png&quot; ,//默认的icon
    &quot;default_title&quot;: &quot;Weather&quot;,//默认鼠标overtitle
    &quot;default_popup&quot;: &quot;popup.html&quot;//弹窗页面
  },
	&quot;permissions&quot;: [ &quot;tabs&quot;, &quot;http://*.weather.com.cn/&quot; ]//跨域请求授权
}


先来个最终效果截图：
通过背景页面来请求天气数据
chrome天气插件用到了weather.com.cn的三个接口：

根据ip获取当前用户所在城市天气编号：http://61.4.185.48:81/g/
根据城市天气编号获取五天内天气：http://m.weather.com.cn/data/&amp;#39;+id+&amp;#39;.html
根据城市天气编号获取实时天气：http://www.weather.com.cn/data/sk/&amp;#39;+id+&amp;#39;.htmlchrome天气插件使用了jQuery开发，所以我们需要在html的头部添加jquery库：1
2
3
4
5
6
7
8
9

### 根据ip获取当前用户所在城市

当用户第一次运行chrome时候，需要请求背景页面，即background.html，这时，我们需要请求接口来获取当前用户所在的城市信息，以根据cityid获取天气情况。代码如下：
```javascript
$.getScript('http://61.4.185.48:81/g/',function(){
	window.localStorage.cityid = id;//保存cityid到localStorage
	getWeather(id);//获取天气信息
});




根据cityid获取天气信息
上一步，涉及到了一个函数getWeather，这个函数的作用就是做一个xmlHttpRequest请求，获取当前cityid的天气信息，包括实时天气。getWeather中运用了send函数来做xmlHttpRequest请求。
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
function getWeather(id){
	var url = 'http://m.weather.com.cn/data/'+id+'.html';
	var url2 = 'http://www.weather.com.cn/data/sk/'+id+'.html';
	send(url,function(json){
		json0 = json;
		window.localStorage.json0 = JSON.stringify(json);
		doit++;
		deal();//处理json0
	}).call(this,url2,function(json){
		json1 = json;
		window.localStorage.json1 = JSON.stringify(json);
		doit++;
		deal();//处理json1
	});

}
function send(url,cb){
	var xhr = new XMLHttpRequest();
	xhr.open(&quot;GET&quot;, url, true);
	xhr.onreadystatechange = function() {
	  if (xhr.readyState == 4) {
		var json = JSON.parse(xhr.responseText);//解析json，保证安全性
		typeof cb==='function' &amp;&amp; json.weatherinfo &amp;&amp; cb(json.weatherinfo);
		xhr = null;
	  }
	}
	xhr.send();
	return arguments.callee;
}">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="chrome扩展应用开发教程之天气预报应用开发"/>
  <meta property="og:site_name" content="三水清"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="atom.xml" title="三水清" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">三水清</a></h1>
  <h2><a href="/">专注前端开发,分享Javascript/CSS/PHP等Web前端开发技巧</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="https://github.com/ksky521">Github</a></li>
    
      <li><a href="http://weibo.com/sanshuiqing">新浪微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon icon-black"></div>
      
      
  
    <h1 class="title">chrome扩展应用开发教程之天气预报应用开发</h1>
  

      <time datetime="2011-10-22T12:14:24.000Z"><a href="/2011/10/22/chrome扩展应用开发教程之天气预报应用开发/">2011年10月22日</a></time>
    </header>
    <div class="entry">
      
        <p>上一篇讲到了<strong>chrome应用开发</strong>的基础知识，这一篇通过周末天气预报插件的开发来讲解下chrome扩展应用的开发过程。熟悉前端开发的童靴，知道了chrome应用开发的基本配置，应该很快就可以开发一个chrome应用，因为chrome插件就是纯粹的javascript和html！</p>
<h2>开发前的准备</h2>
<p>在开发之前需要统筹下，chrome天气预报插件的基本功能和界面，本插件，会这chrome顶部添加一个带有当前天气icon的应用，点击应用打开弹窗页面，天气的数据来自weather.com.cn的接口，所以我们需要跨域授权应用可以请求weather.com.cn的数据。于是chrome天气预报插件的manifest.json部分代码就出来了：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>{
  <span class="string">"name"</span>: <span class="string">"Chrome Weather"</span>, <span class="comment">//name</span>
  <span class="string">"version"</span>: <span class="string">"0.1.0"</span>, <span class="comment">//version</span>
  <span class="string">"description"</span>: <span class="string">"weather."</span>, <span class="comment">//description</span>
  <span class="string">"background_page"</span>: <span class="string">"background.html"</span>,<span class="comment">//背景页面，应用请求数据，处理icon显示实时气温</span>
  <span class="string">"browser_action"</span>: {
    <span class="string">"default_icon"</span>: <span class="string">"icon.png"</span> ,<span class="comment">//默认的icon</span>
    <span class="string">"default_title"</span>: <span class="string">"Weather"</span>,<span class="comment">//默认鼠标overtitle</span>
    <span class="string">"default_popup"</span>: <span class="string">"popup.html"</span><span class="comment">//弹窗页面</span>
  },
	<span class="string">"permissions"</span>: [ <span class="string">"tabs"</span>, <span class="string">"http://*.weather.com.cn/"</span> ]<span class="comment">//跨域请求授权</span>
}
</pre></td></tr></table></figure>

<p>先来个最终效果截图：<br><a href="/uploads/2011/10/2011-10-22_124856-300x80.png"><img src="/uploads/2011/10/2011-10-22_124856-300x80.png" alt="chrome天气预报应用最终效果截图" title="chrome天气预报应用最终效果截图"></a></p>
<h2>通过背景页面来请求天气数据</h2>
<p>chrome天气插件用到了weather.com.cn的三个接口：</p>
<ol>
<li>根据ip获取当前用户所在城市天气编号：<a href="http://61.4.185.48:81/g/" target="_blank">http://61.4.185.48:81/g/</a></li>
<li>根据城市天气编号获取五天内天气：<a href="http://m.weather.com.cn/data/&#39;+id+&#39;.html" target="_blank">http://m.weather.com.cn/data/&#39;+id+&#39;.html</a></li>
<li>根据城市天气编号获取实时天气：<a href="http://www.weather.com.cn/data/sk/&#39;+id+&#39;.html" target="_blank">http://www.weather.com.cn/data/sk/&#39;+id+&#39;.html</a><br>chrome天气插件使用了jQuery开发，所以我们需要在html的头部添加jquery库：<br><pre lang="html"><br><script type="text/javascript" src="js/jquery.min.js"></script><figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>
<span class="comment">### 根据ip获取当前用户所在城市</span>

当用户第一次运行chrome时候，需要请求背景页面，即background.html，这时，我们需要请求接口来获取当前用户所在的城市信息，以根据cityid获取天气情况。代码如下：
```javascript
<span class="variable">$.</span>getScript(<span class="string">'http://61.4.185.48:81/g/'</span>,function(){
	window.localStorage.cityid = id;<span class="regexp">//</span>保存cityid到localStorage
	getWeather(id);<span class="regexp">//</span>获取天气信息
});
</pre></td></tr></table></figure>

</li>
</ol>
<h3>根据cityid获取天气信息</h3>
<p>上一步，涉及到了一个函数getWeather，这个函数的作用就是做一个xmlHttpRequest请求，获取当前cityid的天气信息，包括实时天气。getWeather中运用了send函数来做xmlHttpRequest请求。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getWeather</span><span class="params">(id)</span>{</span>
	<span class="keyword">var</span> url = <span class="string">'http://m.weather.com.cn/data/'</span>+id+<span class="string">'.html'</span>;
	<span class="keyword">var</span> url2 = <span class="string">'http://www.weather.com.cn/data/sk/'</span>+id+<span class="string">'.html'</span>;
	send(url,<span class="keyword">function</span>(json){
		json0 = json;
		window.localStorage.json0 = JSON.stringify(json);
		doit++;
		deal();<span class="comment">//处理json0</span>
	}).call(<span class="keyword">this</span>,url2,<span class="keyword">function</span>(json){
		json1 = json;
		window.localStorage.json1 = JSON.stringify(json);
		doit++;
		deal();<span class="comment">//处理json1</span>
	});

}
<span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(url,cb)</span>{</span>
	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
	xhr.open(<span class="string">"GET"</span>, url, <span class="literal">true</span>);
	xhr.onreadystatechange = <span class="keyword">function</span>() {
	  <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) {
		<span class="keyword">var</span> json = JSON.parse(xhr.responseText);<span class="comment">//解析json，保证安全性</span>
		<span class="keyword">typeof</span> cb===<span class="string">'function'</span> && json.weatherinfo && cb(json.weatherinfo);
		xhr = <span class="literal">null</span>;
	  }
	}
	xhr.send();
	<span class="keyword">return</span> arguments.callee;
}
</pre></td></tr></table></figure>

<a id="more"></a>

<h3>天气信息的处理</h3>
<p>deal函数是处理天气信息，主要代码如下：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">deal</span><span class="params">()</span>{</span>
	<span class="keyword">if</span>(doit===<span class="number">2</span>){
		doit = <span class="number">0</span>;
	}<span class="keyword">else</span>{
		<span class="keyword">return</span>;
	}
	<span class="keyword">var</span> img = <span class="keyword">new</span> Image();
	img.onload = <span class="keyword">function</span>(){
		<span class="keyword">var</span> context = $(<span class="string">'#canvas'</span>)[<span class="number">0</span>].getContext(<span class="string">'2d'</span>);
		context.drawImage(img,<span class="number">0</span>,<span class="number">0</span>,<span class="number">19</span>,<span class="number">19</span>);
                <span class="comment">//通过canvas对象改变icon</span>
		chrome.browserAction.setIcon({imageData:context.getImageData(<span class="number">0</span>, <span class="number">0</span>, <span class="number">19</span>,<span class="number">19</span>)});
	};
	img.src = <span class="string">"http://m.weather.com.cn/weather_img/"</span>+json0.img1+<span class="string">".gif"</span>;
	<span class="keyword">var</span> strTip = json1.city+<span class="string">'现在温度:'</span>+json1.temp+<span class="string">'℃\n今天：'</span>+
                         json0.weather1+json0.temp1+<span class="string">'\n明天：'</span>+
                         json0.weather2+json0.temp2+<span class="string">'\n后天：'</span>+
                         json0.weather3+json0.temp3;
	strTip += <span class="string">"\n最后更新时间："</span>+<span class="keyword">new</span> Date().toLocaleTimeString();
	chrome.browserAction.setTitle({title:strTip});<span class="comment">//设置鼠标经过title</span>
        <span class="comment">//背景颜色</span>
	chrome.browserAction.setBadgeBackgroundColor({color:[<span class="number">0</span>, <span class="number">97</span>, <span class="number">255</span>,<span class="number">100</span>]});
        <span class="comment">//将实时气温显示在icon上面</span>
	chrome.browserAction.setBadgeText({text:json1.temp.toString()});
}
</pre></td></tr></table></figure>

<h3>background.html的全部代码</h3>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="code"><pre><span class="doctype">&lt;!DOCTYPE HTML&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
	<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span>
	<span class="tag">&lt;<span class="title">title</span>&gt;</span>weather<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
	<span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"css/style.css"</span> /&gt;</span>
	<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas"</span> &gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
!<span class="keyword">function</span>(win,doc,$){
	<span class="keyword">var</span> json0,json1,doit = <span class="number">0</span>;
	<span class="function"><span class="keyword">function</span> <span class="title">getWeather</span><span class="params">(id)</span>{</span>
		<span class="keyword">var</span> url = <span class="string">'http://m.weather.com.cn/data/'</span>+id+<span class="string">'.html'</span>;
		<span class="keyword">var</span> url2 = <span class="string">'http://www.weather.com.cn/data/sk/'</span>+id+<span class="string">'.html'</span>;
		send(url,<span class="keyword">function</span>(json){
			json0 = json;
			win.localStorage.json0 = JSON.stringify(json);
			doit++;
			deal();
		}).call(<span class="keyword">this</span>,url2,<span class="keyword">function</span>(json){
			json1 = json;
			win.localStorage.json1 = JSON.stringify(json);
			doit++;
			deal();
		});

	}
	<span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(url,cb)</span>{</span>
		<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
		xhr.open(<span class="string">"GET"</span>, url, <span class="literal">true</span>);
		xhr.onreadystatechange = <span class="keyword">function</span>() {
		  <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) {
			<span class="keyword">var</span> json = JSON.parse(xhr.responseText);
			<span class="keyword">typeof</span> cb===<span class="string">'function'</span> && json.weatherinfo && cb(json.weatherinfo);
			xhr = <span class="literal">null</span>;
		  }
		}
		xhr.send();
		<span class="keyword">return</span> arguments.callee;
	}
	<span class="function"><span class="keyword">function</span> <span class="title">deal</span><span class="params">()</span>{</span>
		<span class="keyword">if</span>(doit===<span class="number">2</span>){
			doit = <span class="number">0</span>;
		}<span class="keyword">else</span>{
			<span class="keyword">return</span>;
		}
		<span class="keyword">var</span> img = <span class="keyword">new</span> Image();
		img.onload = <span class="keyword">function</span>(){
			<span class="keyword">var</span> context = $(<span class="string">'#canvas'</span>)[<span class="number">0</span>].getContext(<span class="string">'2d'</span>);
			context.drawImage(img,<span class="number">0</span>,<span class="number">0</span>,<span class="number">19</span>,<span class="number">19</span>);
			chrome.browserAction.setIcon({imageData:context.getImageData(<span class="number">0</span>, <span class="number">0</span>, <span class="number">19</span>,<span class="number">19</span>)});
		};
		img.src = <span class="string">"http://m.weather.com.cn/weather_img/"</span>+json0.img1+<span class="string">".gif"</span>;
		<span class="keyword">var</span> strTip = json1.city+<span class="string">'现在温度:'</span>+json1.temp+<span class="string">'℃\n今天：'</span>+
			json0.weather1+json0.temp1+<span class="string">'\n明天：'</span>+json0.weather2+json0.temp2+
			<span class="string">'\n后天：'</span>+json0.weather3+json0.temp3;
		strTip += <span class="string">"\n最后更新时间："</span>+<span class="keyword">new</span> Date().toLocaleTimeString();
		chrome.browserAction.setTitle({title:strTip});
		chrome.browserAction.setBadgeBackgroundColor({color:[<span class="number">0</span>, <span class="number">97</span>, <span class="number">255</span>,<span class="number">100</span>]});
		chrome.browserAction.setBadgeText({text:json1.temp.toString()});
	}
	<span class="keyword">var</span> init = <span class="keyword">function</span>(){
		chrome.browserAction.setBadgeText({text:<span class="string">'...'</span>});
		<span class="keyword">if</span>(win.localStorage.cityid){
			getWeather(win.localStorage.cityid);
			<span class="keyword">return</span>;
		}

		$.getScript(<span class="string">'http://61.4.185.48:81/g/'</span>,<span class="keyword">function</span>(){
			win.localStorage.cityid = id;
			getWeather(id);
		});
	};
	$(doc).ready(init);<span class="comment">//页面加载完成就开始初始化</span>

	win.setInterval(init,<span class="number">30</span>*<span class="number">60</span>*<span class="number">1000</span>);<span class="comment">//每间隔三十分钟，请求一下最新的天气数据</span>

}(window,document,jQuery);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</pre></td></tr></table></figure>

<h2>弹窗页面代码</h2>
<p>弹窗页面是当用户点击icon后显示的内容，本实例应用中，点击icon当然是显示完整的天气信息了。数据就不需要再次请求了，在background.html中已经把每次请求下来的数据存入localStorage中，所以可以直接从localStorage中调用完整的天气数据，注意localStorage保存的是string，需要重新解析json哦，不多说了，直接上popup的代码：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="code"><pre><span class="doctype">&lt;!DOCTYPE HTML&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
	<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span>
	<span class="tag">&lt;<span class="title">title</span>&gt;</span>weather<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;<span class="title">table</span> <span class="attribute">width</span>=<span class="value">'780px'</span>&gt;</span>
 <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">rowspan</span>=<span class="value">'2'</span> <span class="attribute">style</span>=<span class="value">"width:130px;text-align:center;"</span>&gt;</span>

#
<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">id</span>=<span class="value">"day1"</span> <span class="attribute">width</span>=<span class="value">"130px"</span>&gt;</span>**今&nbsp;&nbsp;天**<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">id</span>=<span class="value">"day2"</span> <span class="attribute">width</span>=<span class="value">"130px"</span>&gt;</span>**明&nbsp;&nbsp;天**<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">id</span>=<span class="value">"day3"</span> <span class="attribute">width</span>=<span class="value">"130px"</span>&gt;</span>**后&nbsp;&nbsp;天**<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">id</span>=<span class="value">"day4"</span> <span class="attribute">width</span>=<span class="value">"130px"</span>&gt;</span>**第四天**<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
    <span class="tag">&lt;<span class="title">th</span> <span class="attribute">id</span>=<span class="value">"day5"</span> <span class="attribute">width</span>=<span class="value">"130px"</span>&gt;</span>**第五天**<span class="tag">&lt;/<span class="title">th</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span>![](#)<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span>![](#)<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span>![](#)<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span>![](#)<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span>![](#)<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"spanAt"</span>&gt;</span>实时气温:<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>℃<span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp1"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp2"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp3"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp4"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
   <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"temp5"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"spanAt"</span>&gt;</span>风向:<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"WD"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"weather1"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"weather2"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"weather3"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"weather4"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"weather5"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center;"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"spanAt"</span>&gt;</span>湿度:<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"SD"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"wind1"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"wind2"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"wind3"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"wind4"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span> <span class="attribute">style</span>=<span class="value">"text-align:center"</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"wind5"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
<span class="tag">&lt;/<span class="title">table</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
	<span class="keyword">var</span> json1 = JSON.parse(localStorage.json1),json0 = JSON.parse(localStorage.json0);
	[<span class="string">'weather'</span>,<span class="string">'wind'</span>,<span class="string">'temp'</span>].forEach(<span class="keyword">function</span>(v){
		<span class="keyword">var</span> j = <span class="number">6</span>;
		<span class="keyword">while</span>(--j){
			document.getElementById(v+j).innerHTML = json0[v+j];
		}
	});
	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>,step=<span class="number">2</span>;i&lt;<span class="number">10</span>;i+=step){
		document.getElementById(<span class="string">'img'</span>+i).src = <span class="string">"http://m.weather.com.cn/weather_img/"</span>+json0[<span class="string">'img'</span>+i]+<span class="string">".gif"</span>
	}
	<span class="string">"city SD temp WD"</span>.replace(<span class="regexp">/[^ ]+/g</span>,<span class="keyword">function</span>(a){
		document.getElementById(a).innerHTML = json1[a];
	});
	document.getElementById(<span class="string">'cityid'</span>).href = json1.cityid;
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</pre></td></tr></table></figure>

<p>到这里一个简单的chrome天气预报插件就已经完成了，当然还需要完善，比如添加设置页面，用户可以设置自己关心城市，添加手动刷新功能，需要做的事情还是很多的，哈哈~不多说了，主要的代码已经出来了，需要的也可以直接下载我打包好的代码来测试。</p>
<p><a href="//1.qdemo.sinaapp.com/chrome-weather.zip" title="chrome天气预报扩展zip包">chrome天气预报插件扩展zip包</a></p>

      
    </div>
    <footer>
      
        


<div class="articletags clearfix">
	<i class="icon-tag"></i>Tags: <a href="/tags/chrome/">chrome</a>
	<i class="icon-folder"></i>categories:  <a href="/categories/前端开发/">前端开发</a>
</div>


        
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
<span class="bds_more">分享到：</span>
<a class="bds_tsina">新浪微博</a>
<a class="bds_qzone">QQ空间</a>
<a class="bds_tqq">腾讯微博</a>
<a class="bds_renren">人人网</a>
<a class="bds_douban">豆瓣网</a>
<a class="bds_bdhome">百度首页</a>
<a class="bds_youdao">有道云笔记</a>
<a class="bds_copy">复制网址</a>
</div>
<script>
var bds_config = {
    wbUid:'2037334587',
    tsina: '61439547',
    pic:''
};
</script>



        <div class="pagepart clearfix">
 
	<a href="/2011/10/23/chrome扩展应用开发教程之调试和打包上线/" class="prev" title="chrome扩展应用开发教程之调试和打包上线">chrome扩展应用开发教程之调试和打包上线</a>
 
 
	<a href="/2011/10/21/chrome扩展应用开发教程之开发chrome应用基础/" class="next" title="chrome扩展应用开发教程之开发chrome应用基础">chrome扩展应用开发教程之开发chrome应用基础</a>
 
</div>
      
      
<div class="border"></div>
<section class="comment">
    <p class="title ico-comment">文章评论<a name="comments"></a></p>
    <div class="ds-thread" data-title="chrome扩展应用开发教程之天气预报应用开发"></div>
</section>


      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/乱七八糟/">乱七八糟</a><small>30</small></li>
  
    <li><a href="/categories/前端开发/">前端开发</a><small>117</small></li>
  
    <li><a href="/categories/后端运维/">后端运维</a><small>27</small></li>
  
    <li><a href="/categories/王婆卖瓜/">王婆卖瓜</a><small>4</small></li>
  
    <li><a href="/categories/读书笔记/">读书笔记</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签</h3>
  <ul class="entry clearfix">
  
    <li><a href="/tags/DOM/">DOM<sup>2</sup></a></li>
  
    <li><a href="/tags/IE/">IE<sup>1</sup></a></li>
  
    <li><a href="/tags/IE6/">IE6<sup>2</sup></a></li>
  
    <li><a href="/tags/PPT/">PPT<sup>3</sup></a></li>
  
    <li><a href="/tags/VPS/">VPS<sup>1</sup></a></li>
  
    <li><a href="/tags/ajax/">ajax<sup>5</sup></a></li>
  
    <li><a href="/tags/apache/">apache<sup>1</sup></a></li>
  
    <li><a href="/tags/audio/">audio<sup>2</sup></a></li>
  
    <li><a href="/tags/a标签/">a标签<sup>1</sup></a></li>
  
    <li><a href="/tags/canvas/">canvas<sup>1</sup></a></li>
  
    <li><a href="/tags/chrome/">chrome<sup>3</sup></a></li>
  
    <li><a href="/tags/css/">css<sup>15</sup></a></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator<sup>1</sup></a></li>
  
    <li><a href="/tags/ecmascript/">ecmascript<sup>3</sup></a></li>
  
    <li><a href="/tags/escape/">escape<sup>1</sup></a></li>
  
    <li><a href="/tags/event/">event<sup>1</sup></a></li>
  
    <li><a href="/tags/express/">express<sup>1</sup></a></li>
  
    <li><a href="/tags/fis/">fis<sup>1</sup></a></li>
  
    <li><a href="/tags/fisp/">fisp<sup>1</sup></a></li>
  
    <li><a href="/tags/grunt/">grunt<sup>1</sup></a></li>
  
    <li><a href="/tags/handleEvent/">handleEvent<sup>1</sup></a></li>
  
    <li><a href="/tags/html5/">html5<sup>3</sup></a></li>
  
    <li><a href="/tags/iframe/">iframe<sup>1</sup></a></li>
  
    <li><a href="/tags/iptables/">iptables<sup>1</sup></a></li>
  
    <li><a href="/tags/javascript/">javascript<sup>79</sup></a></li>
  
    <li><a href="/tags/linux/">linux<sup>4</sup></a></li>
  
    <li><a href="/tags/livereload/">livereload<sup>1</sup></a></li>
  
    <li><a href="/tags/memcached/">memcached<sup>1</sup></a></li>
  
    <li><a href="/tags/mixjs/">mixjs<sup>1</sup></a></li>
  
    <li><a href="/tags/mysql/">mysql<sup>2</sup></a></li>
  
    <li><a href="/tags/name/">name<sup>1</sup></a></li>
  
    <li><a href="/tags/nginx/">nginx<sup>2</sup></a></li>
  
    <li><a href="/tags/nodejs/">nodejs<sup>7</sup></a></li>
  
    <li><a href="/tags/php/">php<sup>19</sup></a></li>
  
    <li><a href="/tags/session/">session<sup>1</sup></a></li>
  
    <li><a href="/tags/storage/">storage<sup>1</sup></a></li>
  
    <li><a href="/tags/svn/">svn<sup>1</sup></a></li>
  
    <li><a href="/tags/this/">this<sup>1</sup></a></li>
  
    <li><a href="/tags/ueditor/">ueditor<sup>1</sup></a></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs<sup>1</sup></a></li>
  
    <li><a href="/tags/webbench/">webbench<sup>1</sup></a></li>
  
    <li><a href="/tags/websocket/">websocket<sup>1</sup></a></li>
  
    <li><a href="/tags/web前端开发/">web前端开发<sup>5</sup></a></li>
  
    <li><a href="/tags/windows7技巧/">windows7技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/wordpress/">wordpress<sup>3</sup></a></li>
  
    <li><a href="/tags/xss/">xss<sup>3</sup></a></li>
  
    <li><a href="/tags/严格模式/">严格模式<sup>1</sup></a></li>
  
    <li><a href="/tags/位运算/">位运算<sup>1</sup></a></li>
  
    <li><a href="/tags/作用域/">作用域<sup>3</sup></a></li>
  
    <li><a href="/tags/前端优化/">前端优化<sup>1</sup></a></li>
  
    <li><a href="/tags/前端工具/">前端工具<sup>5</sup></a></li>
  
    <li><a href="/tags/加速器/">加速器<sup>1</sup></a></li>
  
    <li><a href="/tags/压力测试/">压力测试<sup>1</sup></a></li>
  
    <li><a href="/tags/右键/">右键<sup>1</sup></a></li>
  
    <li><a href="/tags/安全/">安全<sup>1</sup></a></li>
  
    <li><a href="/tags/性能/">性能<sup>3</sup></a></li>
  
    <li><a href="/tags/我也八卦/">我也八卦<sup>1</sup></a></li>
  
    <li><a href="/tags/执行环境/">执行环境<sup>1</sup></a></li>
  
    <li><a href="/tags/技巧/">技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/播放器/">播放器<sup>1</sup></a></li>
  
    <li><a href="/tags/数组/">数组<sup>1</sup></a></li>
  
    <li><a href="/tags/标签/">标签<sup>1</sup></a></li>
  
    <li><a href="/tags/模块化/">模块化<sup>2</sup></a></li>
  
    <li><a href="/tags/算法/">算法<sup>1</sup></a></li>
  
    <li><a href="/tags/网络技术/">网络技术<sup>73</sup></a></li>
  
    <li><a href="/tags/虚拟主机/">虚拟主机<sup>1</sup></a></li>
  
    <li><a href="/tags/解耦/">解耦<sup>1</sup></a></li>
  
    <li><a href="/tags/语法限制/">语法限制<sup>1</sup></a></li>
  
    <li><a href="/tags/跨域/">跨域<sup>3</sup></a></li>
  
    <li><a href="/tags/路径/">路径<sup>1</sup></a></li>
  
    <li><a href="/tags/软件心得/">软件心得<sup>3</sup></a></li>
  
  </ul>
</div>



  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 三水清
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


    
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6635976" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
        </script>
    
    
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"ksky521"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'http://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




    <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1c76f5cc8274a56106b13b9c9b1fb046' type='text/javascript'%3E%3C/script%3E"));
    </script>


</body>
</html>