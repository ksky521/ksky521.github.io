<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>nodejs - 三水清</title>
  <meta name="author" content="三水清">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="三水清"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="atom.xml" title="三水清" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">三水清</a></h1>
  <h2><a href="/">专注前端开发,分享Javascript/CSS/PHP等Web前端开发技巧</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="https://github.com/ksky521">Github</a></li>
    
      <li><a href="http://weibo.com/sanshuiqing">新浪微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">nodejs</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2012/09/29/将nodejs打包工具整合到鼠标右键/">将nodejs打包工具整合到鼠标右键</a></h1>
  

      <time datetime="2012-09-28T16:34:17.000Z"><a href="/2012/09/29/将nodejs打包工具整合到鼠标右键/">2012年9月29日</a></time>
    </header>
    <div class="entry">
      
        <p>昨天放出了主要的nodejs打包代码(《<a href="/2012/09/28/nodejs%E5%86%99%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7/">nodejs写的简单项目打包工具</a>》)，今天放出整合到鼠标右键的代码，打包需要配置环境变量，添加NODE_PATH为node安装路径，打包用到的批处理文件代码如下：</p>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="code"><pre>@<span class="keyword">echo</span> off
title Builder - 正在合并 ...

color 03
REM =====================================
REM     jsbuilder beta版
REM
REM =====================================
SETLOCAL ENABLEEXTENSIONS

<span class="keyword">echo</span>.

REM 过滤文件后缀，只combo js文件
<span class="keyword">if</span> <span class="string">"%~x1"</span> NEQ <span class="string">".js"</span> (
    <span class="keyword">echo</span>.
    <span class="keyword">echo</span> **** 请选择JS文件
    <span class="keyword">echo</span>.
    goto End
)

REM 检查NODE_PATH
<span class="keyword">if</span> <span class="string">"%NODE_PATH%"</span> == <span class="string">""</span> goto NoNodePath
<span class="keyword">if</span> not exist <span class="string">"%NODE_PATH%\node.exe"</span> goto NoNodePath

<span class="keyword">set</span> RESULT_FILE=%~n1-combo%~x1

:ZIP_CHOICE

<span class="keyword">echo</span> 选择是否【压缩】合并后的js文件?
<span class="keyword">set</span> input=
<span class="keyword">set</span> /p input= -^&gt; 请选择(y/n):
<span class="keyword">if</span> /i <span class="string">"%input%"</span>==<span class="string">"n"</span> goto UNZIP
<span class="keyword">if</span> /i <span class="string">"%input%"</span>==<span class="string">"y"</span> goto ZIP

REM 调用build合并文件
:UNZIP
<span class="string">"%NODE_PATH%\node.exe"</span> <span class="string">"%~dp0build.js"</span> --unzip <span class="string">"%~n1%~x1"</span> &gt; <span class="string">"%RESULT_FILE%"</span>
<span class="keyword">echo</span>.
<span class="keyword">echo</span> **** ~O(∩_∩)O~ 【合并】成功 ****
<span class="keyword">echo</span>.
goto End

REM 调用build合并并且压缩文件
:ZIP
<span class="string">"%NODE_PATH%\node.exe"</span> <span class="string">"%~dp0build.js"</span> <span class="string">"%~n1%~x1"</span> &gt; <span class="string">"%RESULT_FILE%"</span>
<span class="keyword">echo</span>.
<span class="keyword">echo</span> **** ~O(∩_∩)O~ 【合并并压缩】成功 ****
<span class="keyword">echo</span>.
goto End

:NoNodePath
<span class="keyword">echo</span>.
<span class="keyword">echo</span> **** 请先安装NodeJS并设置NODE_PATH环境变量 ****
<span class="keyword">echo</span>.

:End
ENDLOCAL
pause
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/09/29/将nodejs打包工具整合到鼠标右键/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2012/09/28/nodejs写的一个简单项目打包工具/">nodejs写的一个简单项目打包工具</a></h1>
  

      <time datetime="2012-09-27T17:49:17.000Z"><a href="/2012/09/28/nodejs写的一个简单项目打包工具/">2012年9月28日</a></time>
    </header>
    <div class="entry">
      
        <p>项目是模块加载的，类似<code>require.js</code>的用法，所以简单写了一个js打包工具。<br>项目的模块加载和定义部分代码是这样的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>XX.define(<span class="string">'ns'</span>,[<span class="string">'tool/cookie'</span>],<span class="keyword">function</span>(){
});
<span class="comment">//或者</span>
XX.define(<span class="string">'ns.ns2'</span>,<span class="string">'tool/cookie,tool/abc'</span>,<span class="keyword">function</span>(){
})
<span class="comment">//或者</span>
XX.define(<span class="string">'ns'</span>,<span class="keyword">function</span>(){
})
</pre></td></tr></table></figure>

<p>所用到的js打包工具就是扫描文件，然后匹配出来需要加载的模块，然后先加载模块代码。<br>主要的nodejs打包工具代码如下：<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/09/28/nodejs写的一个简单项目打包工具/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2012/04/20/nodeppt-—-nodejs做的手机端控制pc端的ppt演示文档javascript框架/">nodePPT — nodejs做的手机端控制PC端的PPT演示文档javascript框架</a></h1>
  

      <time datetime="2012-04-20T10:47:01.000Z"><a href="/2012/04/20/nodeppt-—-nodejs做的手机端控制pc端的ppt演示文档javascript框架/">2012年4月20日</a></time>
    </header>
    <div class="entry">
      
        <p><a href="https://github.com/ksky521/nodePPT" target="_blank">nodePPT</a>使用nodejs写的，可以手机端控制pc端的演示文档框架。<strong>nodePPT</strong>是在<a href="https://github.com/ksky521/webSlide" target="_blank">webSlide</a>基础上二次开发的，使用nodejs做服务器，通过websocket来实现手机端和PC的通信，主要功能是手机端可以控制pc端PPT播放进度，并且手机端可以给每张PPT做备注。</p>
<p>第一次做个程序的<strong>nodejs</strong>作品，并且测试时间比较短，肯定会有很多问题和bug，希望大家一起斧正。另外页面样式css高手可以自己写，包括动画自定义都可以在css文件中直接修改添加。</p>
<h2>说明</h2>
<p>因为是PPT演示文档，所以需要投影仪分辨率，所以演示页面的最佳分辨率为全屏模式下的 <code>1024*768</code> ，如果在自己电脑上查看，可以通过 <code>ctrl + -</code> 和 <code>ctrl + +</code> 缩放到合适的比例查看效果。</p>
<p>建议浏览器chrome 16+，全屏模式（F11），以达到最佳动画效果。在Firefox下会出现拖尾现象，个人认为是Firefox 8下对CSS3动画效果渲染太慢导致，其他浏览器未测试。<br><a href="/uploads/2012/04/796f423btw1ds70hjcu93j.jpg"><img src="/uploads/2012/04/796f423btw1ds70hjcu93j.jpg" alt="nodePPT iphone手机端截图" title="nodePPT iphone手机端截图"></a></p>
<h4>使用说明</h4>
<ol>
<li>配置route.json</li>
<li>配置ppt的文件</li>
<li>启动node：node server.js</li>
<li>PC访问：如127.0.0.1:3000/demo.ppt</li>
<li>手机端访问：127.0.0.1:3000/ctrl</li>
<li>手机端setup，选择控制用户后，开始控制</li>
</ol>
<p>具体使用方法启动node server.js之后访问127.0.0.1:3000/index.ppt，里面有详细的介绍</p>
<h2>快捷键</h2>
<ul>
<li>空格/→/↓/Tab/pageDown：下一页</li>
<li>←/↑/pageUp：上一页</li>
<li>P：开画板</li>
<li>C：清除画板</li>
</ul>
<h2>版本库地址</h2>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/04/20/nodeppt-—-nodejs做的手机端控制pc端的ppt演示文档javascript框架/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/09/29/基于expresssocket-io的nodejs聊天室/">基于express+socket.io的nodejs聊天室</a></h1>
  

      <time datetime="2011-09-29T15:20:24.000Z"><a href="/2011/09/29/基于expresssocket-io的nodejs聊天室/">2011年9月29日</a></time>
    </header>
    <div class="entry">
      
        <p>前几天晚上边看水浒边写的<a href="http://js8.in/tag/nodejs">nodejs</a>的聊天室，前面说了，放假之前要把近日学习nodejs的所有心得整理下，今天就是30号鸟~撒欢~，最后放这个聊天室出来给大家作为学习<strong>nodejs</strong>的参考示例，希望对大家有用。</p>
<p>感谢：cnodejs群里的老雷，及其<a href="http://weibo.com/sanshuiqing" target="_blank">微博</a>上的基友们！顺祝大家长假快乐，顺祝自己明天动车不出轨，顺祝明年不再过节，感慨多了……</p>
<h3>特点</h3>
<p>聊天室主要功能及其特点：</p>
<ol>
<li>采用nodejs（屁话）</li>
<li>express框架,jade做模板</li>
<li>socket.io做前后端的websocket通信</li>
<li>支持session</li>
<li>支持@私信功能<br>废话不多说了，注意点，基本前面的文章都提到了，下面罗列下：<br>《<a href="http://js8.in/764.html">配置nodejs.exe的windows目录结构</a>》<br>《<a href="http://js8.in/774.html">安装express及配置app.js文件</a>》<br>《<a href="http://js8.in/784.html">使用socket.io和node.js搭建websocket应用</a>》<br>《<a href="http://js8.in/788.html">在Express和Socket.IO中使用session</a>》</li>
</ol>
<h3>nodejs聊天室下载地址</h3>
<p><a href="http://1.nodejsdemo.sinaapp.com/chat/chat.zip" title="基于express+socket.io的聊天室" target="_blank">基于express+socket.io的聊天室</a></p>
<h3>聊天室服务器端js代码</h3>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/09/29/基于expresssocket-io的nodejs聊天室/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/09/29/在express和socket-io中使用session/">在Express和Socket.IO中使用session</a></h1>
  

      <time datetime="2011-09-29T14:32:53.000Z"><a href="/2011/09/29/在express和socket-io中使用session/">2011年9月29日</a></time>
    </header>
    <div class="entry">
      
        <p>在nodejs项目中对于一些认证需要用到<strong>session</strong>，例如我写的nodejs 聊天室的demo，就是通过session实现的认证。当存在session，直接进入聊天室，而不会重新登录。</p>
<p>在网上也找到不少关于Express框架中的session调用方法，可是发现真正能用的不是很多，今天根据聊天室的制作过程，整理下Express和socket.IO中使用session的具体方法。</p>
<p>Express的session是通过cookie实现的，用到了connect中的两个module：parseCookie和MemoryStore，前者是用来解析cookie，后者用来存储sesion。</p>
<h2>引入所需module</h2>
<p>Express框架中使用session必须先引入上面的两个模块，例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> parseCookie = require(<span class="string">'connect'</span>).utils.parseCookie,
	MemoryStore = require(<span class="string">'connect/middleware/session/memory'</span>);
<span class="comment">//建立一个memory store的实例</span>
<span class="keyword">var</span> storeMemory = <span class="keyword">new</span> MemoryStore({
		reapInterval: <span class="number">60000</span> * <span class="number">10</span>
	});
</pre></td></tr></table></figure>

<h2>Express中app的配置</h2>
<p>在app需要添加如下的配置：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>app.configure(<span class="keyword">function</span>(){
	app.use(express.bodyParser());<span class="comment">//解析post</span>
	app.use(express.cookieParser());<span class="comment">//解析cookie</span>
	<span class="comment">//设置session</span>
	app.use(express.session({
		secret: <span class="string">'wyq'</span>,
		store:storeMemory
	}));
});
</pre></td></tr></table></figure>

<h2>在请求中使用session</h2>
<p>在请求中我们可以使用request.session来调用session，例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>app.get(<span class="string">'/'</span>,<span class="keyword">function</span>(req,res){
	<span class="comment">//使用request.session来判断是否登录</span>
	<span class="keyword">if</span>( req.session.name && req.session.name!==<span class="string">''</span>){
		<span class="comment">//需要判断下是否已经登录</span>
		res.redirect(<span class="string">'/chat'</span>);
	}<span class="keyword">else</span>{
		<span class="comment">//读取登录页面，要求登录</span>
		<span class="keyword">var</span> realpath = __dirname + <span class="string">'/views/'</span> + url.parse(<span class="string">'login.html'</span>).pathname;
		<span class="keyword">var</span> txt = fs.readFileSync(realpath);
		res.end(txt);
	}
});
</pre></td></tr></table></figure>

<h2>websocket通信中使用session</h2>
<p>在nodejs项目中，我们常常使用websockt来实现通信，所以websocket中也需要通过session来认证用户。本例使用socket.io来举例实现nodejs中websocket通信session的认证。关于socket.io的使用参考文章《<a href="http://js8.in/784.html">使用socket.io和node.js搭建websocket应用</a>》</p>
<p>上面代码中引入了解析cookie的<strong>parseCookie</strong>，所以session是通过cookie来解析的。首先我们建立了socket的监听之后需要对监听到的头文件处理，解析出来cookie中的session。例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="keyword">var</span> io = sio.listen(app);
<span class="comment">//设置session</span>
io.set(<span class="string">'authorization'</span>, <span class="keyword">function</span>(handshakeData, callback){
	<span class="comment">// 通过客户端的cookie字符串来获取其session数据</span>
	handshakeData.cookie = parseCookie(handshakeData.headers.cookie)
	<span class="keyword">var</span> connect_sid = handshakeData.cookie[<span class="string">'connect.sid'</span>];
	<span class="keyword">if</span> (connect_sid) {
		storeMemory.get(connect_sid, <span class="keyword">function</span>(error, session){
			<span class="keyword">if</span> (error) {
				<span class="comment">// if we cannot grab a session, turn down the connection</span>
				callback(error.message, <span class="literal">false</span>);
			}
			<span class="keyword">else</span> {
				<span class="comment">// save the session data and accept the connection</span>
				handshakeData.session = session;
				callback(<span class="literal">null</span>, <span class="literal">true</span>);
			}
		});
	}
	<span class="keyword">else</span> {
		callback(<span class="string">'nosession'</span>);
	}
});
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/09/29/在express和socket-io中使用session/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/09/28/使用socket-io和node-js搭建websocket应用/">使用socket.io和node.js搭建websocket应用</a></h1>
  

      <time datetime="2011-09-28T15:42:21.000Z"><a href="/2011/09/28/使用socket-io和node-js搭建websocket应用/">2011年9月28日</a></time>
    </header>
    <div class="entry">
      
        <p><strong>websocket</strong>是HTML5的一种新的通信协议，它是实现了浏览器与服务器的双向通讯。在 WebSocket API 中，浏览器和服务器只需要要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。<br>关于websocket的更多信息，请移步<a href="http://zh.wikipedia.org/wiki/WebSocket" target="_blank">维基百科</a></p>
<h2>使用WebSocket</h2>
<p>在客户端使用websocket需要创建WebSocket对象，通过提供的open、send、message、close等方法实现创建、发送、监听信息、关闭连接。例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="keyword">if</span>(<span class="string">'WebSocket'</span> <span class="keyword">in</span> window){
	<span class="comment">// 创建websocket实例</span>
	<span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8080'</span>);
	<span class="comment">//打开</span>
	socket.onopen = <span class="keyword">function</span>(event) {
	  <span class="comment">// 发送</span>
	  socket.send(<span class="string">'I am the client and I\'m listening!'</span>);
	  <span class="comment">// 监听</span>
	  socket.onmessage = <span class="keyword">function</span>(event) {
		console.log(<span class="string">'Client received a message'</span>,event);
	  };
	  <span class="comment">// 关闭监听</span>
	  socket.onclose = <span class="keyword">function</span>(event) {
		console.log(<span class="string">'Client notified socket has closed'</span>,event);
	  };
	  <span class="comment">// 关闭</span>
	  <span class="comment">//socket.close()</span>
	};
}<span class="keyword">else</span>{
	alert(<span class="string">'本浏览器不支持WebSocket哦~'</span>);
}
</pre></td></tr></table></figure>

<p>现在chrome、firefox等浏览器都已经支持了websocket，而IE却没有。下面我们来简单说说服务器端对websocket的支持。</p>
<p>服务器端支持<strong>websocket</strong>的语言不少，而且都有相关的开源项目，例如php的phpwebsockets：<a href="http://code.google.com/p/phpwebsockets/" target="_blank"><a href="http://code.google.com/p/phpwebsockets/">http://code.google.com/p/phpwebsockets/</a></a>，java的jWebsocket：<a href="http://jwebsocket.org/" target="_blank"><a href="http://jwebsocket.org/">http://jwebsocket.org/</a></a>。<br>更多的信息可以浏览这篇文章：<a href="http://net.tutsplus.com/tutorials/javascript-ajax/start-using-html5-websockets-today/" target="_blank">Start Using HTML5 WebSockets Today</a></p>
<h2>socket.io</h2>
<p><strong>socket.IO</strong>是一个websocket库，包括了客户端的js和服务器端的nodejs。官方地址：<a href="http://socket.io" target="_blank"><a href="http://socket.io">http://socket.io</a></a></p>
<h3>客户端使用socket.io</h3>
<p>去github clone socket.io的最新版本，或者直接饮用使用socket.io的CDN服务：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://cdn.socket.io/stable/socket.io.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<p>下面可以创建使用socket.io库来创建客户端js代码了：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> socket = io.connect(<span class="string">'http://localhost'</span>);
socket.on(<span class="string">'news'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
	console.log(data);
	socket.emit(<span class="string">'my other event'</span>, { my: <span class="string">'data'</span> });
});
</pre></td></tr></table></figure>

<p>socket.on是监听，收到服务器端发来的news的内容，则运行function，其中data就是请求回来的数据，socket.emit是发送消息给服务器端的方法。</p>
<h3>使用socket.io和nodejs搭建websocket服务器端</h3>
<p>socket.io不仅可以搭建客户端的websocket服务，而且支持nodejs服务器端的websocket。</p>
<h3>nodejs安装socket.io</h3>
<p>使用node插件管理包，运行下面的命令就可以安装成功socket.io</p>
<blockquote>
<p>npm install socket.io</p>
</blockquote>
<p>没有npm的或者windows用户可以使用github下载socket.io并且放入到node_modules文件夹中，具体配置可以参考文章：《nodejs教程：配置nodejs.exe的windows目录结构》</p>
<h3>nodejs建立socket.io服务</h3>
<p>通过nodejs的http模块就可以方便的搭建websocket服务器环境，例如下面的代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre>// 引入需要的模块：http和socket.io
var http = require('http'), io = require('socket.io');
//创建server
var server = http.createServer(function(req, res){
  // Send HTML headers and message
  res.writeHead(200,{ 'Content-Type': 'text/html' });
  res.end('

# Hello Socket Lover!
');
});
//端口8000
server.listen(8080);
//创建socket
var socket = io.listen(server);
//添加连接监听
socket.on('connection', function(client){
	//连接成功则执行下面的监听
	client.on('message',function(event){
		console.log('Received message from client!',event);
	});
	//断开连接callback
	client.on('disconnect',function(){
		console.log('Server has disconnected');
	});
});
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/09/28/使用socket-io和node-js搭建websocket应用/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/09/27/nodejs教程：安装express即配置app-js文件/">nodejs教程：安装express及配置app.js文件</a></h1>
  

      <time datetime="2011-09-26T22:35:52.000Z"><a href="/2011/09/27/nodejs教程：安装express即配置app-js文件/">2011年9月27日</a></time>
    </header>
    <div class="entry">
      
        <p><strong>express.js</strong>是nodejs的一个MVC开发框架，并且支持jade等多种模板。下面简单来说说express的安装和app.js文件的配置，然后在今后的教程中一步一步使用express.js搭建个聊天室。</p>
<h2>安装express.js</h2>
<p>如果你安装了npm，安装变得很简单，只需要在终端中运行下面的代码即可：</p>
<blockquote>
<p>npm install express -gd<br>-g代表安装到NODE_PATH的lib里面，而-d代表把相依性套件也一起安装。如果沒有-g的话会安装目前所在的目录(会建立一个node_modules的文件夹)，你可以透过以下指令来比较两者的不同：</p>
<p>npm list -g<br>npm list</p>
</blockquote>
<p>如果没有npm，那么我可以使用github来git下来最新的express。<br>好了，现在你可以通过<code>express testapp</code>来建立express实例。以下是示例：</p>
<blockquote>
<p>cd ~<br>express testapp<br>cd testapp<br>node app.js<br>这样就建立了一个testapp的<strong>nodejs</strong>应用，而app.js是默认的应用主js。下面来详细的说说app.js中的各项配置。</p>
</blockquote>
<h2>引入模块</h2>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> express = require(<span class="string">'express'</span>);
 <span class="keyword">var</span> app = module.exports = express.createServer();
</pre></td></tr></table></figure>

<p>require()是node.js提供的函数，可以让你引入其他模块以调用模块的函数和变量，默认下node.js会在$NODE_PATH和目前js所在目录下的node_modules文件夹下去寻找模块。require也可以用来载入自己写的模块哦~这样涉及到node.js的模块机制，后面有机会就在介绍。</p>
<p>第二行的express.createServer()就是在建立server，而中间的module.exports也是涉及到node.js的模块机制，以后再说。</p>
<h2>express的app.js的详细配置说明</h2>
<p>express.js继承自connect模块，所以如果你的node_modules文件夹下没有connect模块也是不行的。</p>
<h3>设置views路径和模板</h3>
<p>我们再来看下面两行：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>app.set(<span class="string">'views'</span>, __dirname + <span class="string">'/views'</span>);
app.set(<span class="string">'view engine'</span>, <span class="string">'jade'</span>);
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/09/27/nodejs教程：安装express即配置app-js文件/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/乱七八糟/">乱七八糟</a><small>30</small></li>
  
    <li><a href="/categories/前端开发/">前端开发</a><small>117</small></li>
  
    <li><a href="/categories/后端运维/">后端运维</a><small>27</small></li>
  
    <li><a href="/categories/王婆卖瓜/">王婆卖瓜</a><small>4</small></li>
  
    <li><a href="/categories/读书笔记/">读书笔记</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签</h3>
  <ul class="entry clearfix">
  
    <li><a href="/tags/DOM/">DOM<sup>2</sup></a></li>
  
    <li><a href="/tags/IE/">IE<sup>1</sup></a></li>
  
    <li><a href="/tags/IE6/">IE6<sup>2</sup></a></li>
  
    <li><a href="/tags/PPT/">PPT<sup>3</sup></a></li>
  
    <li><a href="/tags/VPS/">VPS<sup>1</sup></a></li>
  
    <li><a href="/tags/ajax/">ajax<sup>5</sup></a></li>
  
    <li><a href="/tags/apache/">apache<sup>1</sup></a></li>
  
    <li><a href="/tags/audio/">audio<sup>2</sup></a></li>
  
    <li><a href="/tags/a标签/">a标签<sup>1</sup></a></li>
  
    <li><a href="/tags/canvas/">canvas<sup>1</sup></a></li>
  
    <li><a href="/tags/chrome/">chrome<sup>3</sup></a></li>
  
    <li><a href="/tags/css/">css<sup>15</sup></a></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator<sup>1</sup></a></li>
  
    <li><a href="/tags/ecmascript/">ecmascript<sup>3</sup></a></li>
  
    <li><a href="/tags/escape/">escape<sup>1</sup></a></li>
  
    <li><a href="/tags/event/">event<sup>1</sup></a></li>
  
    <li><a href="/tags/express/">express<sup>1</sup></a></li>
  
    <li><a href="/tags/fis/">fis<sup>1</sup></a></li>
  
    <li><a href="/tags/fisp/">fisp<sup>1</sup></a></li>
  
    <li><a href="/tags/grunt/">grunt<sup>1</sup></a></li>
  
    <li><a href="/tags/handleEvent/">handleEvent<sup>1</sup></a></li>
  
    <li><a href="/tags/html5/">html5<sup>3</sup></a></li>
  
    <li><a href="/tags/iframe/">iframe<sup>1</sup></a></li>
  
    <li><a href="/tags/iptables/">iptables<sup>1</sup></a></li>
  
    <li><a href="/tags/javascript/">javascript<sup>79</sup></a></li>
  
    <li><a href="/tags/linux/">linux<sup>4</sup></a></li>
  
    <li><a href="/tags/livereload/">livereload<sup>1</sup></a></li>
  
    <li><a href="/tags/memcached/">memcached<sup>1</sup></a></li>
  
    <li><a href="/tags/mixjs/">mixjs<sup>1</sup></a></li>
  
    <li><a href="/tags/mysql/">mysql<sup>2</sup></a></li>
  
    <li><a href="/tags/name/">name<sup>1</sup></a></li>
  
    <li><a href="/tags/nginx/">nginx<sup>2</sup></a></li>
  
    <li><a href="/tags/nodejs/">nodejs<sup>7</sup></a></li>
  
    <li><a href="/tags/php/">php<sup>19</sup></a></li>
  
    <li><a href="/tags/session/">session<sup>1</sup></a></li>
  
    <li><a href="/tags/storage/">storage<sup>1</sup></a></li>
  
    <li><a href="/tags/svn/">svn<sup>1</sup></a></li>
  
    <li><a href="/tags/this/">this<sup>1</sup></a></li>
  
    <li><a href="/tags/ueditor/">ueditor<sup>1</sup></a></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs<sup>1</sup></a></li>
  
    <li><a href="/tags/webbench/">webbench<sup>1</sup></a></li>
  
    <li><a href="/tags/websocket/">websocket<sup>1</sup></a></li>
  
    <li><a href="/tags/web前端开发/">web前端开发<sup>5</sup></a></li>
  
    <li><a href="/tags/windows7技巧/">windows7技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/wordpress/">wordpress<sup>3</sup></a></li>
  
    <li><a href="/tags/xss/">xss<sup>3</sup></a></li>
  
    <li><a href="/tags/严格模式/">严格模式<sup>1</sup></a></li>
  
    <li><a href="/tags/位运算/">位运算<sup>1</sup></a></li>
  
    <li><a href="/tags/作用域/">作用域<sup>3</sup></a></li>
  
    <li><a href="/tags/前端优化/">前端优化<sup>1</sup></a></li>
  
    <li><a href="/tags/前端工具/">前端工具<sup>5</sup></a></li>
  
    <li><a href="/tags/加速器/">加速器<sup>1</sup></a></li>
  
    <li><a href="/tags/压力测试/">压力测试<sup>1</sup></a></li>
  
    <li><a href="/tags/右键/">右键<sup>1</sup></a></li>
  
    <li><a href="/tags/安全/">安全<sup>1</sup></a></li>
  
    <li><a href="/tags/性能/">性能<sup>3</sup></a></li>
  
    <li><a href="/tags/我也八卦/">我也八卦<sup>1</sup></a></li>
  
    <li><a href="/tags/执行环境/">执行环境<sup>1</sup></a></li>
  
    <li><a href="/tags/技巧/">技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/播放器/">播放器<sup>1</sup></a></li>
  
    <li><a href="/tags/数组/">数组<sup>1</sup></a></li>
  
    <li><a href="/tags/标签/">标签<sup>1</sup></a></li>
  
    <li><a href="/tags/模块化/">模块化<sup>2</sup></a></li>
  
    <li><a href="/tags/算法/">算法<sup>1</sup></a></li>
  
    <li><a href="/tags/网络技术/">网络技术<sup>73</sup></a></li>
  
    <li><a href="/tags/虚拟主机/">虚拟主机<sup>1</sup></a></li>
  
    <li><a href="/tags/解耦/">解耦<sup>1</sup></a></li>
  
    <li><a href="/tags/语法限制/">语法限制<sup>1</sup></a></li>
  
    <li><a href="/tags/跨域/">跨域<sup>3</sup></a></li>
  
    <li><a href="/tags/路径/">路径<sup>1</sup></a></li>
  
    <li><a href="/tags/软件心得/">软件心得<sup>3</sup></a></li>
  
  </ul>
</div>



  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 三水清
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


    
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6635976" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
        </script>
    
    



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




    <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1c76f5cc8274a56106b13b9c9b1fb046' type='text/javascript'%3E%3C/script%3E"));
    </script>


</body>
</html>