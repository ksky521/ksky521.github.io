<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>php - 三水清</title>
  <meta name="author" content="三水清">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="三水清"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="atom.xml" title="三水清" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">三水清</a></h1>
  <h2><a href="/">专注前端开发,分享Javascript/CSS/PHP等Web前端开发技巧</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="https://github.com/ksky521">Github</a></li>
    
      <li><a href="http://weibo.com/sanshuiqing">新浪微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">php</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2012/05/22/过滤xss（跨站脚本攻击）的函数和防止svn版本库被浏/">过滤XSS（跨站脚本攻击）的函数和防止svn版本库被浏览</a></h1>
  

      <time datetime="2012-05-22T09:19:36.000Z"><a href="/2012/05/22/过滤xss（跨站脚本攻击）的函数和防止svn版本库被浏/">2012年5月22日</a></time>
    </header>
    <div class="entry">
      
        <p>别处看到的php去除xss的函数，自己备份下，以备不时之需。</p>
<h2>php过滤xss函数</h2>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="code"><pre><span class="preprocessor">&lt;?php</span>
<span class="comment">/**
* @过滤XSS（跨站脚本攻击）的函数
*<span class="phpdoc"> @par</span> $val 字符串参数，可能包含恶意的脚本代码如
* &lt;script language="javascript"&gt;alert("hello world");&lt;/script&gt;
*<span class="phpdoc"> @return</span>  处理后的字符串
*<span class="phpdoc"> @Recoded</span> By Androidyue
**/</span>
<span class="function"><span class="keyword">function</span> <span class="title">RemoveXSS</span><span class="params">(<span class="variable">$val</span>)</span> {</span>
   <span class="comment">// remove all non-printable characters. CR(0a) and LF(0b)</span>
   <span class="comment">// and TAB(9) are allowed</span>
   <span class="comment">// this prevents some character re-spacing such as &lt;java\0script&gt;</span>
   <span class="comment">// note that you have to handle splits with \n, \r,</span>
   <span class="comment">// and \t later since they *are* allowed in some inputs</span>
   <span class="variable">$val</span> = preg_replace(<span class="string">'/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/'</span>, <span class="string">''</span>, <span class="variable">$val</span>);

   <span class="comment">// straight replacements, the user should never need these</span>
   <span class="comment">// since they're normal characters</span>
   <span class="comment">// this prevents like ![](@avascript:alert()</span>
   <span class="variable">$search</span> = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span>;
   <span class="variable">$search</span> .= <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>;
   <span class="variable">$search</span> .= <span class="string">'1234567890!@#$%^&*()'</span>;
   <span class="variable">$search</span> .= <span class="string">'~`";:?+/={}[]-_|\'\\'</span>;
   <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$search</span>); <span class="variable">$i</span>++) {
      <span class="comment">// ;? matches the ;, which is optional</span>
      <span class="comment">// 0{0,7} matches any padded zeros, which are optional and go up to 8 chars</span>

      <span class="comment">// @ @ search for the hex values</span>
      <span class="variable">$val</span> = preg_replace(<span class="string">'/(&#[xX]0{0,8}'</span>.dechex(ord(<span class="variable">$search</span>[<span class="variable">$i</span>])).<span class="string">';?)/i'</span>, <span class="variable">$search</span>[<span class="variable">$i</span>], <span class="variable">$val</span>); <span class="comment">// with a ;</span>
      <span class="comment">// @ @ 0{0,7} matches '0' zero to seven times</span>
      <span class="variable">$val</span> = preg_replace(<span class="string">'/(&#0{0,8}'</span>.ord(<span class="variable">$search</span>[<span class="variable">$i</span>]).<span class="string">';?)/'</span>, <span class="variable">$search</span>[<span class="variable">$i</span>], <span class="variable">$val</span>); <span class="comment">// with a ;</span>
   }

   <span class="comment">// now the only remaining whitespace attacks are \t, \n, and \r</span>
   <span class="variable">$ra1</span> = <span class="keyword">Array</span>(<span class="string">'javascript'</span>, <span class="string">'vbscript'</span>, <span class="string">'expression'</span>, <span class="string">'applet'</span>, <span class="string">'meta'</span>, <span class="string">'xml'</span>, <span class="string">'blink'</span>, <span class="string">'link'</span>, <span class="string">'style'</span>, <span class="string">'script'</span>, <span class="string">'embed'</span>, <span class="string">'object'</span>, <span class="string">'iframe'</span>, <span class="string">'frame'</span>, <span class="string">'frameset'</span>, <span class="string">'ilayer'</span>, <span class="string">'layer'</span>, <span class="string">'bgsound'</span>, <span class="string">'title'</span>, <span class="string">'base'</span>);
   <span class="variable">$ra2</span> = <span class="keyword">Array</span>(<span class="string">'onabort'</span>, <span class="string">'onactivate'</span>, <span class="string">'onafterprint'</span>, <span class="string">'onafterupdate'</span>, <span class="string">'onbeforeactivate'</span>, <span class="string">'onbeforecopy'</span>, <span class="string">'onbeforecut'</span>, <span class="string">'onbeforedeactivate'</span>, <span class="string">'onbeforeeditfocus'</span>, <span class="string">'onbeforepaste'</span>, <span class="string">'onbeforeprint'</span>, <span class="string">'onbeforeunload'</span>, <span class="string">'onbeforeupdate'</span>, <span class="string">'onblur'</span>, <span class="string">'onbounce'</span>, <span class="string">'oncellchange'</span>, <span class="string">'onchange'</span>, <span class="string">'onclick'</span>, <span class="string">'oncontextmenu'</span>, <span class="string">'oncontrolselect'</span>, <span class="string">'oncopy'</span>, <span class="string">'oncut'</span>, <span class="string">'ondataavailable'</span>, <span class="string">'ondatasetchanged'</span>, <span class="string">'ondatasetcomplete'</span>, <span class="string">'ondblclick'</span>, <span class="string">'ondeactivate'</span>, <span class="string">'ondrag'</span>, <span class="string">'ondragend'</span>, <span class="string">'ondragenter'</span>, <span class="string">'ondragleave'</span>, <span class="string">'ondragover'</span>, <span class="string">'ondragstart'</span>, <span class="string">'ondrop'</span>, <span class="string">'onerror'</span>, <span class="string">'onerrorupdate'</span>, <span class="string">'onfilterchange'</span>, <span class="string">'onfinish'</span>, <span class="string">'onfocus'</span>, <span class="string">'onfocusin'</span>, <span class="string">'onfocusout'</span>, <span class="string">'onhelp'</span>, <span class="string">'onkeydown'</span>, <span class="string">'onkeypress'</span>, <span class="string">'onkeyup'</span>, <span class="string">'onlayoutcomplete'</span>, <span class="string">'onload'</span>, <span class="string">'onlosecapture'</span>, <span class="string">'onmousedown'</span>, <span class="string">'onmouseenter'</span>, <span class="string">'onmouseleave'</span>, <span class="string">'onmousemove'</span>, <span class="string">'onmouseout'</span>, <span class="string">'onmouseover'</span>, <span class="string">'onmouseup'</span>, <span class="string">'onmousewheel'</span>, <span class="string">'onmove'</span>, <span class="string">'onmoveend'</span>, <span class="string">'onmovestart'</span>, <span class="string">'onpaste'</span>, <span class="string">'onpropertychange'</span>, <span class="string">'onreadystatechange'</span>, <span class="string">'onreset'</span>, <span class="string">'onresize'</span>, <span class="string">'onresizeend'</span>, <span class="string">'onresizestart'</span>, <span class="string">'onrowenter'</span>, <span class="string">'onrowexit'</span>, <span class="string">'onrowsdelete'</span>, <span class="string">'onrowsinserted'</span>, <span class="string">'onscroll'</span>, <span class="string">'onselect'</span>, <span class="string">'onselectionchange'</span>, <span class="string">'onselectstart'</span>, <span class="string">'onstart'</span>, <span class="string">'onstop'</span>, <span class="string">'onsubmit'</span>, <span class="string">'onunload'</span>);
   <span class="variable">$ra</span> = array_merge(<span class="variable">$ra1</span>, <span class="variable">$ra2</span>);

   <span class="variable">$found</span> = <span class="keyword">true</span>; <span class="comment">// keep replacing as long as the previous round replaced something</span>
   <span class="keyword">while</span> (<span class="variable">$found</span> == <span class="keyword">true</span>) {
      <span class="variable">$val_before</span> = <span class="variable">$val</span>;
      <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; sizeof(<span class="variable">$ra</span>); <span class="variable">$i</span>++) {
         <span class="variable">$pattern</span> = <span class="string">'/'</span>;
         <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; strlen(<span class="variable">$ra</span>[<span class="variable">$i</span>]); <span class="variable">$j</span>++) {
            <span class="keyword">if</span> (<span class="variable">$j</span> &gt; <span class="number">0</span>) {
               <span class="variable">$pattern</span> .= <span class="string">'('</span>;
               <span class="variable">$pattern</span> .= <span class="string">'(&#[xX]0{0,8}([9ab]);)'</span>;
               <span class="variable">$pattern</span> .= <span class="string">'|'</span>;
               <span class="variable">$pattern</span> .= <span class="string">'|(&#0{0,8}([9|10|13]);)'</span>;
               <span class="variable">$pattern</span> .= <span class="string">')*'</span>;
            }
            <span class="variable">$pattern</span> .= <span class="variable">$ra</span>[<span class="variable">$i</span>][<span class="variable">$j</span>];
         }
         <span class="variable">$pattern</span> .= <span class="string">'/i'</span>;
         <span class="variable">$replacement</span> = substr(<span class="variable">$ra</span>[<span class="variable">$i</span>], <span class="number">0</span>, <span class="number">2</span>).<span class="string">'&lt;x&gt;'</span>.substr(<span class="variable">$ra</span>[<span class="variable">$i</span>], <span class="number">2</span>);
         <span class="comment">// add in &lt;&gt; to nerf the tag</span>
         <span class="variable">$val</span> = preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$val</span>);
         <span class="comment">// filter out the hex tags</span>
         <span class="keyword">if</span> (<span class="variable">$val_before</span> == <span class="variable">$val</span>) {
            <span class="comment">// no replacements were made, so exit the loop</span>
            <span class="variable">$found</span> = <span class="keyword">false</span>;
         }
      }
   }
   <span class="keyword">return</span> <span class="variable">$val</span>;
}
<span class="comment">//测试一下效果</span>
<span class="comment">//echo RemoveXSS("&lt;script language='javascript'&gt;alert('hello world');&lt;/script&gt;") ;</span>
<span class="preprocessor">?&gt;</span>
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/22/过滤xss（跨站脚本攻击）的函数和防止svn版本库被浏/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2012/02/02/php实现javascript的escape和unescape函数/">PHP实现javascript的escape和unescape函数</a></h1>
  

      <time datetime="2012-02-02T12:57:03.000Z"><a href="/2012/02/02/php实现javascript的escape和unescape函数/">2012年2月2日</a></time>
    </header>
    <div class="entry">
      
        <p><strong>前端开发</strong>工程师都知道javascript有编码函数<code>escape()</code>和对应的解码函数<code>unescape()</code>，而php中只有个urlencode和urldecode，这个编码和解码函数对encodeURI和encodeURIComponent有效，但是对<strong>escape</strong>的是无效的。</p>
<p>javascript中的<code>escape()</code>函数和<code>unescape()</code>函数用户字符串编码，类似于PHP中的<code>urlencode()</code>函数，下面是php实现的<code>escape</code>函数代码：</p>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="code"><pre><span class="comment">/**
 * js escape php 实现
 *<span class="phpdoc"> @param</span> $string           the sting want to be escaped
 *<span class="phpdoc"> @param</span> $in_encoding
 *<span class="phpdoc"> @param</span> $out_encoding
 */</span>
<span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(<span class="variable">$string</span>, <span class="variable">$in_encoding</span> = <span class="string">'UTF-8'</span>,<span class="variable">$out_encoding</span> = <span class="string">'UCS-2'</span>)</span> {</span>
    <span class="variable">$return</span> = <span class="string">''</span>;
    <span class="keyword">if</span> (function_exists(<span class="string">'mb_get_info'</span>)) {
        <span class="keyword">for</span>(<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> &lt; mb_strlen ( <span class="variable">$string</span>, <span class="variable">$in_encoding</span> ); <span class="variable">$x</span> ++) {
            <span class="variable">$str</span> = mb_substr ( <span class="variable">$string</span>, <span class="variable">$x</span>, <span class="number">1</span>, <span class="variable">$in_encoding</span> );
            <span class="keyword">if</span> (strlen ( <span class="variable">$str</span> ) &gt; <span class="number">1</span>) { <span class="comment">// 多字节字符</span>
                <span class="variable">$return</span> .= <span class="string">'%u'</span> . strtoupper ( bin2hex ( mb_convert_encoding ( <span class="variable">$str</span>, <span class="variable">$out_encoding</span>, <span class="variable">$in_encoding</span> ) ) );
            } <span class="keyword">else</span> {
                <span class="variable">$return</span> .= <span class="string">'%'</span> . strtoupper ( bin2hex ( <span class="variable">$str</span> ) );
            }
        }
    }
    <span class="keyword">return</span> <span class="variable">$return</span>;
}
```php
&lt;!--more--&gt;

对应的解码**php unescape**代码是：

```php
<span class="function"><span class="keyword">function</span> <span class="title">unescape</span><span class="params">(<span class="variable">$str</span>)</span>
{</span>
    <span class="variable">$ret</span> = <span class="string">''</span>;
    <span class="variable">$len</span> = strlen(<span class="variable">$str</span>);
    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span> ++)
    {
        <span class="keyword">if</span> (<span class="variable">$str</span>[<span class="variable">$i</span>] == <span class="string">'%'</span> && <span class="variable">$str</span>[<span class="variable">$i</span> + <span class="number">1</span>] == <span class="string">'u'</span>)
        {
            <span class="variable">$val</span> = hexdec(substr(<span class="variable">$str</span>, <span class="variable">$i</span> + <span class="number">2</span>, <span class="number">4</span>));
            <span class="keyword">if</span> (<span class="variable">$val</span> &lt; <span class="number">0x7f</span>)
                <span class="variable">$ret</span> .= chr(<span class="variable">$val</span>);
            <span class="keyword">else</span>
                <span class="keyword">if</span> (<span class="variable">$val</span> &lt; <span class="number">0x800</span>)
                    <span class="variable">$ret</span> .= chr(<span class="number">0xc0</span> | (<span class="variable">$val</span> &gt;&gt; <span class="number">6</span>)) .
                     chr(<span class="number">0x80</span> | (<span class="variable">$val</span> & <span class="number">0x3f</span>));
                <span class="keyword">else</span>
                    <span class="variable">$ret</span> .= chr(<span class="number">0xe0</span> | (<span class="variable">$val</span> &gt;&gt; <span class="number">12</span>)) .
                     chr(<span class="number">0x80</span> | ((<span class="variable">$val</span> &gt;&gt; <span class="number">6</span>) & <span class="number">0x3f</span>)) .
                     chr(<span class="number">0x80</span> | (<span class="variable">$val</span> & <span class="number">0x3f</span>));
            <span class="variable">$i</span> += <span class="number">5</span>;
        } <span class="keyword">else</span>
            <span class="keyword">if</span> (<span class="variable">$str</span>[<span class="variable">$i</span>] == <span class="string">'%'</span>)
            {
                <span class="variable">$ret</span> .= urldecode(substr(<span class="variable">$str</span>, <span class="variable">$i</span>, <span class="number">3</span>));
                <span class="variable">$i</span> += <span class="number">2</span>;
            } <span class="keyword">else</span>
                <span class="variable">$ret</span> .= <span class="variable">$str</span>[<span class="variable">$i</span>];
    }
    <span class="keyword">return</span> <span class="variable">$ret</span>;
}
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/06/13/json_encode数组出现unicode-uxxxx的解决方案/">json_encode数组出现unicode \uxxxx的解决方案</a></h1>
  

      <time datetime="2011-06-13T15:16:15.000Z"><a href="/2011/06/13/json_encode数组出现unicode-uxxxx的解决方案/">2011年6月13日</a></time>
    </header>
    <div class="entry">
      
        <p>端午和上个周末做的微博应用<a href="//dali.sinaapp.com">送大礼</a>中设计到ajax返回json的数据格式中，我没有完全使用PHP默认的<strong>json_encode</strong>来编码，因为这样编码出来的是unicode编码的，也就是\u的编码，虽然unicode编码可以在不同的页面中编码不会出现乱码问题。但是一个汉字编码成unicode会变成\u+4个字符，这样在字符长度上要比汉字多。</p>
<p>因为我的php文件和html声明中都是使用的UTF-8，不会出现编码乱码问题，所以就放弃了直接使用json_encode的方法，而是把汉字先<strong>urlencode</strong>然后再使用json_encode，json_encode之后再次使用urldecode来解码，这样编码出来的json数组中的汉字就不会出现unicode编码了~<br>代码如下</p>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="comment">//默认为：{"test":"\u6211\u662f\u6d4b\u8bd5"}</span>
<span class="variable">$array</span> = <span class="keyword">array</span>(
	<span class="string">'test'</span>=&gt;urlencode(<span class="string">"我是测试"</span>)
);
<span class="variable">$array</span> = json_encode(<span class="variable">$array</span>);
<span class="keyword">echo</span> urldecode(<span class="variable">$array</span>);
<span class="comment">//{"test":"我是测试"}</span>
</pre></td></tr></table></figure>

<p>此举主要是为了节省传输字符数，因为我的<a href="//dali.sinaapp.com">送大礼</a>默认会引入几百个好友信息，对于数据的流量还是比较大的~所以采用汉字传输要比unicode字符编码传输要节省带宽~而且处理好了页面编码问题，不会出现乱码现象。</p>
<h3>json_encode出null的问题</h3>
<p>如果文档编码或者字符串编码（例如UTF-8抓取了一个GBK页面）为非UTF-8，就会出现json_encode编码失败的问题，变现为输出汉字为null。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/06/13/json_encode数组出现unicode-uxxxx的解决方案/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/02/14/使用xdebug调试php-找出php程序的瓶颈/">使用xdebug调试PHP 找出PHP程序的瓶颈</a></h1>
  

      <time datetime="2011-02-14T15:24:17.000Z"><a href="/2011/02/14/使用xdebug调试php-找出php程序的瓶颈/">2011年2月14日</a></time>
    </header>
    <div class="entry">
      
        <p><strong>xdebug</strong>是PHP的一个扩展应用，有了xdebug就可以轻松的调试PHP程序，有了它，我们就不用使用<code>var_dump()</code>，<code>print_r()</code>之类的傻瓜调试函数了。<br>Xdebug则提供了更多的功能，能全方位的对PHP脚本进行调试。<strong>Xdebug</strong>主要的功能如下：</p>
<ol>
<li>堆栈追踪和函数追踪；</li>
<li>错误信息；</li>
<li>内存分配；</li>
<li>剖析php脚本的信息；</li>
<li>代码覆盖率分析；</li>
<li>远程调试分析；</li>
</ol>
<h3>1、Ubuntu搭建xdebug调试环境</h3>
<h4>安装Xdebug模块</h4>
<p>在终端中使用apt-get安装xdebug，命令如下</p>
<blockquote>
<p>sudo apt-get install php5-dev php-pear<br>sudo apt-get install php5-xdebug<br>然后打开php.ini文件(例如gedit /etc/php5/apache2/php.ini)。进行如下配置；<br>;加载xdebug动态链接库<br>extension=xdebug.so<br>;xdebug分析文件输出路径<br>xdebug.profiler_output_dir = “/var/www/xdebug/”<br>;分析器默认是关闭，调试的时候在url中加入XDEBUG_PROFILE=true即可<br>xdebug.profiler_enable = Off<br>xdebug.profiler_enable_trigger = 1<br>重启apache，这样就可以使用xdebug调试PHP了。</p>
</blockquote>
<h3>2、windows下安装xdebug</h3>
<p>以PHP5.1.4，Windows平台为例（其它PHP版本，其它平台请参看官网文档）：<br>1． 登录www.xdebug.org，在首页右侧有一个Windows modules，选择其中的PHP5.1.2+，下载php_xdebug-5.1.2-2.0.0beta6.dll文件；<br>2． 将下载的php_xdebug-5.1.2-2.0.0beta6.dll放到C:\php5\ext目录，重命名为php_xdebug.dll；<br>3． 编辑php.ini，加入下面几行：</p>
<blockquote>
<p>extension=php_xdebug.dll<br>[Xdebug]<br>xdebug.profiler_enable=on<br>xdebug.trace_output_dir=&quot;I:\Projects\xdebug&quot;<br>xdebug.profiler_output_dir=&quot;I:\Projects\xdebug&quot;<br>xdebug.dump.GET=*<br>xdebug.show_local_vars=1<br>具体参数PHP.ini说明参见ubuntu下的注释。</p>
</blockquote>
<h3>3、使用xdebug进行PHP调试</h3>
<h4>xdebug调试变量更加友好</h4>
<p>Xdebug重写了php里面<code>var_dump()</code>函数。<br>xdebug里的var_dump()给变量对象有不同的颜色，显示类型长度，还可以控制显示层次，显示的方式经过格式化，清晰友好。<br>需要使用此功能，有如下参数需注意。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/02/14/使用xdebug调试php-找出php程序的瓶颈/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/01/20/修改获取验证码图片到本地的php程序/">修改获取验证码图片到本地的PHP程序</a></h1>
  

      <time datetime="2011-01-20T14:54:55.000Z"><a href="/2011/01/20/修改获取验证码图片到本地的php程序/">2011年1月20日</a></time>
    </header>
    <div class="entry">
      
        <p>昨天写了《<a href="http://js8.in/666.html" title="练手：一个获取验证码图片到本地的PHP程序">练手：一个获取验证码图片到本地的PHP程序</a>》的文章，对于<strong>验证码</strong>为jpg格式的图片是可以正常输出的，对于png、gif的验证码则不能正常使用，今天稍微修改一下<strong>PHP</strong>代码，使其可以支持png、gif、jpg三种格式的验证码。<br>PHP判断图片的格式可使用php内置的<code>exif_imagetype</code>函数，非常方便，<br>关于<strong>exif_imagetype</strong>的详细使用方法可以访问：<a href="http://php.net/manual/en/function.exif-imagetype.php" target="_blank"><a href="http://php.net/manual/en/function.exif-imagetype.php">http://php.net/manual/en/function.exif-imagetype.php</a></a><br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/01/20/修改获取验证码图片到本地的php程序/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2011/01/19/练手：一个获取验证码图片到本地的php程序/">练手：一个获取验证码图片到本地的PHP程序</a></h1>
  

      <time datetime="2011-01-19T13:51:32.000Z"><a href="/2011/01/19/练手：一个获取验证码图片到本地的php程序/">2011年1月19日</a></time>
    </header>
    <div class="entry">
      
        <p>最近项目不是很大，所以时间比较的空间，昨天琢磨着写点东西，想起了前几天电信公司投票选微笑天使的活动，投票是要填写验证码的，想了下想写个投票作弊程序，可是等我放假回来，人家活动已经结束了，昨天突然想起来，就写了一个获取<strong>验证码图片</strong>到本地的PHP程序，以备今后有类似的投票活动可以直接拿来使用。</p>
<p>程序采用了PHP的<strong>GD库</strong>，原理很简单，就是先建立一张空白图片，然后把验证码的图片使用PHP GD库中的<strong>imagecreatefromjpeg</strong>函数建立一个image对象，最后计算图片的长宽，再次使用<strong>PHP</strong>内置的<strong>imagecopy</strong>复制到一开始建立的空白图片上去。<br>全部代码如下：<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/01/19/练手：一个获取验证码图片到本地的php程序/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/12/20/利用百度ping服务api加快文章收录，秒收不是梦/">利用百度ping服务API加快文章收录，秒收不是梦</a></h1>
  

      <time datetime="2010-12-19T17:04:15.000Z"><a href="/2010/12/20/利用百度ping服务api加快文章收录，秒收不是梦/">2010年12月20日</a></time>
    </header>
    <div class="entry">
      
        <p>上一篇文章提到了<a href="http://js8.in/644.html" title="利用google博客的ping服务接口API加快网站收录">谷歌的ping服务接口</a>，其实国内的搜索引擎<strong>百度</strong>也有类似的服务，今天就介绍下百度博客ping服务，<a href="http://www.baidu.com/search/blogsearch_help.html#n7" target="_blank">百度博客Ping服务的详细介绍</a>，请移步：<a href="http://www.baidu.com/search/blogsearch_help.html#n7" target="_blank"><a href="http://www.baidu.com/search/blogsearch_help.html#n7">http://www.baidu.com/search/blogsearch_help.html#n7</a></a>。百度的<strong>ping服务</strong>也是基于XML-RPC标准协议，但是与谷歌ping服务不同的是百度的ping发送的xml格式不同，我们需要使用string节点包裹内容。</p>
<p>例如：</p>
<blockquote>
<figure class="highlight lang-xml"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre>
&gt; <span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
&gt; <span class="tag">&lt;<span class="title">methodCall</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">methodName</span>&gt;</span>weblogUpdates.extendedPing<span class="tag">&lt;/<span class="title">methodName</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">params</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">value</span>&gt;</span><span class="tag">&lt;<span class="title">string</span>&gt;</span>断桥残雪部落格<span class="tag">&lt;/<span class="title">string</span>&gt;</span><span class="tag">&lt;/<span class="title">value</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">value</span>&gt;</span><span class="tag">&lt;<span class="title">string</span>&gt;</span>http://js8.in/<span class="tag">&lt;/<span class="title">string</span>&gt;</span><span class="tag">&lt;/<span class="title">value</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">value</span>&gt;</span><span class="tag">&lt;<span class="title">string</span>&gt;</span>http://js8.in/644.html<span class="tag">&lt;/<span class="title">string</span>&gt;</span><span class="tag">&lt;/<span class="title">value</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;<span class="title">value</span>&gt;</span><span class="tag">&lt;<span class="title">string</span>&gt;</span>http://js8.in/feed<span class="tag">&lt;/<span class="title">string</span>&gt;</span><span class="tag">&lt;/<span class="title">value</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">param</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">params</span>&gt;</span>
&gt; <span class="tag">&lt;/<span class="title">methodCall</span>&gt;</span>
&gt;
</pre></td></tr></table></figure>

</blockquote>
<p>根据<a href="http://js8.in/644.html" title="利用google博客的ping服务接口API加快网站收录">上篇</a>提到的谷歌接口，我们只要改变一下提交的xml内容即可，当然百度ping服务返回的判断也是跟谷歌的不同，也可以做相应的修改，<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/12/20/利用百度ping服务api加快文章收录，秒收不是梦/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/12/17/利用google博客的ping服务接口api加快网站收录/">利用google博客的ping服务接口API加快网站收录</a></h1>
  

      <time datetime="2010-12-17T10:38:02.000Z"><a href="/2010/12/17/利用google博客的ping服务接口api加快网站收录/">2010年12月17日</a></time>
    </header>
    <div class="entry">
      
        <p>谷歌博客推出了<strong>ping</strong>服务已经很长时间了，如果我们的博客是wordpress可以很方便的设置ping服务，但是如果我们的博客不是wordpress，或者我们的网站程序是自己手写的，那么就要自己写<strong>RPC</strong>代码了。今天断桥残雪分享一下自己写的PHP的XML-RPC代码。在此之前先说说ping服务的好处以及wordpress的ping设置。</p>
<h3>配置ping服务，加快收录速度</h3>
<p>谷歌的ping服务是一种快速收录的方法，打个比方就是：我们写了一篇文章想要谷歌收录，我们就可以使用ping服务来通知下谷歌，要googlebot尽快来抓取收录。谷歌官方的解释：</p>
<blockquote>
<p>通过 Google“博客搜索”Ping API, 用户可以程序化的方式将博客内容的更新通知给 Google“博客搜索”引擎。这对于经常更新博客内容的用户尤其有用。博客服务提供商的管理人员也可以利用此API将其平台上的博客内容变化向 Google 通告，以便 Google“博客搜索”及时抓取来自这一服务提供商的最新内容。为设置对 Google“博客搜索”的自动 Ping 机制，请按照如下所述设置<strong>XML-RPC</strong>客户端或REST客户端以发送请求。您可以任选一种方法进行通知；两者都将按照相同的方式进行处理。</p>
</blockquote>
<h3>wordpress设置ping的方法</h3>
<p>wordpress自身就带着ping服务，只要我们配置一下就可以了，步骤是：设置→撰写→更新服务。常用的ping服务有以下几个：</p>
<blockquote>
<p><a href="http://rpc.pingomatic.com/" target="_blank">http://rpc.pingomatic.com/</a><br><a href="http://ping.baidu.com/ping/RPC2(百度的" target="_blank">http://ping.baidu.com/ping/RPC2(百度的</a>)<br><a href="http://blogsearch.google.com/ping/RPC2(谷歌的" target="_blank">http://blogsearch.google.com/ping/RPC2(谷歌的</a>)<br><a href="http://api.my.yahoo.com/RPC2(雅虎的" target="_blank">http://api.my.yahoo.com/RPC2(雅虎的</a>)<br><a href="http://api.my.yahoo.com/rss/ping(雅虎的" target="_blank">http://api.my.yahoo.com/rss/ping(雅虎的</a>)<br><a href="http://www.feedsky.com/api/RPC2(feedsky的" target="_blank">http://www.feedsky.com/api/RPC2(feedsky的</a>)</p>
</blockquote>
<h3>谷歌ping服务的PHP代码</h3>
<p>关于RPC的详细介绍可以移步<a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBwQFjAA&amp;url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FRemote_procedure_call&amp;ei=KRkMTdv4DdCOcY-t0cEK&amp;usg=AFQjCNFk4Xj6zVRWzO_H81TzbHeO9cBhjw&amp;sig2=_CO0Vdcrd56r46zJM3oyJw" target="_blank">维基百科</a>，谷歌ping服务的标准：</p>
<p><span>RPC端点：<span> </span><a href="http://blogsearch.google.com/ping/RPC2" target="_blank">http://blogsearch.google.com/ping/RPC2</a><span> </span><br>调用方法名：<span> </span>weblogUpdates.extendedPing<span> </span><br>参数：<span> </span>(应按照如下所列的相同顺序传送)</span></p>
<p><span><em>   站点名
</em>   站点URL<br><em>   需要检查更新的页面URL
</em>   相应的RSS、RDF或Atom种子的URL<br>*   可选：页面内容的分类名称(或标签)。您可以指定多个值，之间用‘|’字符进行分隔。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/12/17/利用google博客的ping服务接口api加快网站收录/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/10/13/sina-app-engine开发实例：天气预报的定时短信（二）/">Sina App Engine开发实例：天气预报的定时短信（二）</a></h1>
  

      <time datetime="2010-10-13T09:00:54.000Z"><a href="/2010/10/13/sina-app-engine开发实例：天气预报的定时短信（二）/">2010年10月13日</a></time>
    </header>
    <div class="entry">
      
        <p>昨天简单介绍了下新浪App Engine的应用，并且介绍了通过weather.com.cn的接口获取天气预报的方法。今天继续开始我们的SAE开发实例之旅。今天主要介绍下使用<strong>飞信</strong>接口发送短信和使用Sina App Engine的<strong>crontab</strong>（计划任务）功能。</p>
<p><a href="http://js8.in/633.html">Sina App Engine开发实例：天气预报的定时短信（一）</a> | <a href="http://js8.in/634.html">天气预报的定时短信（二）</a></p>
<blockquote>
<p>广告时间：</p>
<h3>新浪微博送祝福方法</h3>
<p>1、在发布新浪微博的时候，采用以下格式，会在5分钟之内把您的祝福发送出去，并且收到一个@回复：</p>
<p><span style="color: #ff0000;"><strong>@微博送祝福：祝××：祝福的内容</strong></span></p>
<p>2、登录<a href="http://js8.in/love" title="新浪微博送祝福"><a href="http://js8.in/love">http://js8.in/love</a></a>，使用新浪微博账号登陆，然后给自己的粉丝、好友送祝福</p>
<p>每一个祝福都会收到一个@回复，并且具有自己独一无二的永久URL地址，你可以复制发送给自己的好友，要TA知道你送的祝福~</p>
</blockquote>
<h3>介绍下这次开发实例中使用的飞信接口</h3>
<p>此次开发使用的Fetion（飞信）接口是由张宴提供的第三方Fetion API，通过这个接口可以方便的给自己和自己的好友发送短信，具体的介绍，请移步<a href="http://blog.s135.com/fetion_api/" title="飞信接口" target="_blank">这里</a>。<br>调用的格式如下：</p>
<blockquote>
<p><a href="http://sms.api.bz/fetion.php?username=您的移动飞信登录手机号&amp;password=您的移动飞信登录密码&amp;sendto=接收短信的飞信好友手机号（也可以是你自己的手机号）&amp;message=短信内容" target="_blank">http://sms.api.bz/fetion.php?username=您的移动飞信登录手机号&amp;password=您的移动飞信登录密码&amp;sendto=接收短信的飞信好友手机号（也可以是你自己的手机号）&amp;message=短信内容</a><br>可以使用GET，POST方法。<br>结合<a href="http://js8.in/633.html">上篇</a>中介绍的SAE的<strong>FetchURL</strong>方法，我们可以很轻松的写出来，飞信接口发短信的PHP代码：</p>
</blockquote>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre> <span class="variable">$sms</span>[<span class="string">"username"</span>] = <span class="number">13812345678</span>;
 <span class="variable">$sms</span>[<span class="string">"password"</span>] = <span class="string">"password"</span>;
 <span class="variable">$sms</span>[<span class="string">"sendto"</span>] = <span class="number">13812345678</span>;
 <span class="variable">$sms</span>[<span class="string">"message"</span>] = <span class="string">"这是一条测试短信！"</span>;
<span class="variable">$f</span> = <span class="keyword">new</span> SaeFetchurl();
 <span class="variable">$f</span>-&gt;setMethod(<span class="string">'post'</span>);
 <span class="variable">$f</span>-&gt;setPostData( <span class="variable">$sms</span>);
 <span class="variable">$ret</span> = <span class="variable">$f</span>-&gt;fetch(<span class="string">'http://sms.api.bz/fetion.php'</span>);
 var_dump(<span class="variable">$ret</span>);
</pre></td></tr></table></figure>

<p><strong>PS</strong>:对于该接口是否记录飞信密码，断桥残雪不清楚，不过张宴说自己不记录，大家自己辨别。</p>
<h3>Sina App Engine的Crontab服务</h3>
<p>用过linux系统的应该知道crontab是Linux系统下的计划任务，也就是我们可以通过配置Crontab，让电脑在固定的时间运行固定的程序。断桥残雪通过crontab的服务实现了在新浪微博以：“<span style="color: #ff0000;"><strong>@微博送祝福：祝××：祝福的内容</strong></span>”的格式发布微博，可以在5分钟内送出祝福，并且收到@回复的功能。<br><strong>新浪App Engin</strong>e对cron的介绍可以移步：<a href="http://sae.sina.com.cn/?m=devcenter&amp;catId=26" target="_blank"><a href="http://sae.sina.com.cn/?m=devcenter&amp;catId=26">http://sae.sina.com.cn/?m=devcenter&amp;catId=26</a></a><br>我们可以通过修改SDK文件夹里面的<strong>config.yaml</strong>来开启crontab任务。格式如下：<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/10/13/sina-app-engine开发实例：天气预报的定时短信（二）/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/10/12/sina-app-engine开发实例：天气预报的定时短信（一）/">Sina App Engine开发实例：天气预报的定时短信（一）</a></h1>
  

      <time datetime="2010-10-12T09:41:43.000Z"><a href="/2010/10/12/sina-app-engine开发实例：天气预报的定时短信（一）/">2010年10月12日</a></time>
    </header>
    <div class="entry">
      
        <p>新浪的云计算平台（<a href="http://sae.sina.com.cn/" title="新浪云计算" target="_blank">Sina App Engine</a>）已经开发一段时间了，一直处于内测阶段，最近找到一个邀请码，注册了一个<strong>SAE</strong>，我也上云了！使用SAE并且做了一个<strong><a href="http://js8.in/love" title="微博送祝福">微博送祝福</a></strong>的应用。通过crontab的服务实现了在新浪微博以：“<span style="color: #ff0000;"><strong>@微博送祝福：祝××：祝福的内容</strong></span>”的格式发布微博，可以在5分钟内送出祝福，并且收到@回复的功能。</p>
<p>今天结合张宴提供的飞信API接口，做个定时发送天气预报的SAE应用，算是<strong>新浪SAE的教程</strong>吧。</p>
<p><a href="http://js8.in/633.html">Sina App Engine开发实例：天气预报的定时短信（一）</a> | <a href="http://js8.in/634.html">天气预报的定时短信（二）</a></p>
<blockquote>
<p>广告时间：</p>
<h3>新浪微博送祝福方法</h3>
<p>1、在发布新浪微博的时候，采用以下格式，会在5分钟之内把您的祝福发送出去，并且收到一个@回复：</p>
<p><span style="color: #ff0000;"><strong>@微博送祝福：祝××：祝福的内容</strong></span></p>
<p>2、登录<a href="http://js8.in/love" title="新浪微博送祝福"><a href="http://js8.in/love">http://js8.in/love</a></a>，使用新浪微博账号登陆，然后给自己的粉丝、好友送祝福</p>
<p>每一个祝福都会收到一个@回复，并且具有自己独一无二的永久URL地址，你可以复制发送给自己的好友，要TA知道你送的祝福~</p>
</blockquote>
<h3>Sina App Engine简介</h3>
<p><strong>Google App Engine</strong>大家应该不陌生吧，SAE是类似产品，不同的是GAE提供的是Java和python支持，而新浪的SAE提供的是PHP的支持，包括基本的PHP5、mySQL5.，也包括一些高级的应用<strong>Crontab</strong>（定时任务），<strong>memcache</strong>（缓存）、<strong>SMTP</strong>（邮箱服务），新的功能还在添加中。最让我们兴奋的是提供了crontab计划任务功能，我们可以不花一分钱就能做到定时任务，例如定时发送邮件（结合SMTP），还有今天的实例，天气预报定时短信。而且这些服务我们需要花费少量的“云豆”就可以实现！</p>
<p>详情请参阅：<a href="http://sae.sina.com.cn/" target="_blank"><a href="http://sae.sina.com.cn/">http://sae.sina.com.cn/</a></a></p>
<h3>Sina App Engine基本操作教程</h3>
<p>相对于GAE的黑脸CMD命令行操作，SAE的图形界面更加亲切。注册一个SAE账号之后，我们就可以下载<a href="http://sae.sina.com.cn/?m=sdk" target="_blank">Sina App Engine SDK</a> 包括了windows版本和Mac/Linux版本。</p>
<p>具体是SDK操作教程请看在线视频：<a href="http://xhprof.tools.sinaapp.com/demo_beta/" target="_blank"><a href="http://xhprof.tools.sinaapp.com/demo_beta/">http://xhprof.tools.sinaapp.com/demo_beta/</a></a></p>
<h3>天气预报抓取程序，采用SAE的FetchURL类</h3>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/10/12/sina-app-engine开发实例：天气预报的定时短信（一）/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/10/02/新浪微博应用开发之一：授权机制介绍/">新浪微博应用开发之一：授权机制介绍</a></h1>
  

      <time datetime="2010-10-02T15:02:43.000Z"><a href="/2010/10/02/新浪微博应用开发之一：授权机制介绍/">2010年10月2日</a></time>
    </header>
    <div class="entry">
      
        <p>题记：国庆期间没有出去玩，也没有回家，只有蜗居在家，闲来无事，研究了下<strong>新浪微博</strong>和<strong>人人网</strong>的开发平台。特把研究成果及其经验写成博客，分享给大家。首先先说说我开发的新浪微博应用：<a href="http://js8.in/love" title="新浪微博送祝福">微博祝福</a>，以及人人网应用：<a href="http://js8.in/renren" title="人人祝福墙">人人祝福墙</a>。这两个应用都是根据<a href="http://love.js8.in" title="断桥残雪爱墙" target="_blank">爱墙程序</a>修改而成，并且采用了我的<a href="http://js8.in/wbox">jquery插件wBox</a>。</p>
<p>今天主要讲一讲新浪微博应用开发的授权机制问题，因为新浪最近跟CSND合作举办一个APP开发大赛，所以今天想说下新浪微博的应用开发。新浪微博是采用两种授权方法：一种是<strong>HTTP普通验证</strong>(<strong>Basic Authentication</strong>)方式，另外一种是<strong>OAuth</strong>，前面一种是最直接的方法，用户输入账号密码登陆，而第三方网站需要记录用户的账号密码下次才能认证成功，不然每次都要输密码很麻烦，并且对于用户来说很不安全。第二种<a href="http://blog.csdn.net/hereweare2009/archive/2009/03/08/3968582.aspx" target="_blank">OAuth</a>是比较安全的，用户需要跳到新浪官方输入账号密码，然后通过三步来换取Access Token，说起来比较麻烦，不过得到了这个Token之后就可以请求到新浪微博的API了，用户还可以随时通过新浪微博取消这个认证授权。</p>
<h3>HTTP普通验证</h3>
<p>最简单的认证方式，断桥残雪之前写的Follow5 API类就是使用这样的方法，其原理就是使用<strong>curl</strong>一个URL来请求API接口，已获得开放的数据。<br>关于HTTP普通验证的方法，大家可以参考我之前写的一个<a href="http://js8.in/349.html">Follow5 API PHP类</a>，关于curl的详细操作，大家可以看这篇文章《<a href="http://js8.in/379.html">cURL常用的几个PHP函数</a>》</p>
<h3>OAuth认证方法</h3>
<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/10/02/新浪微博应用开发之一：授权机制介绍/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/09/03/使用php把excelxls文件导入mysql数据库/">使用PHP把excel(xls)文件导入mysql数据库</a></h1>
  

      <time datetime="2010-09-03T11:43:24.000Z"><a href="/2010/09/03/使用php把excelxls文件导入mysql数据库/">2010年9月3日</a></time>
    </header>
    <div class="entry">
      
        <p>昨晚一个客户联系我<a href="http://js8.in/537.html" title="承接企业网站建设，企业建站工作">做网站</a>，提出的要求是需要把客户提供的<strong>excel文件</strong>里面的数据导入到mysql数据库，最常用的方法就是先把<strong>xls</strong>文件导出为csv格式的文件，然后在解析csv格式的文件导入到<strong>mysql数据库</strong>。方法比较冗余，而且分好几步进行，很不方便，断桥残雪今天介绍一种方法是直接跳过<strong>csv</strong>的中间环节，直接把excel文件导入mysql数据库。</p>
<p>首先我们需要下载<strong>PHP-ExcelReader</strong>这是一个开源的项目，主要是来解析excel的文件，下载地址：<a href="http://sourceforge.net/projects/phpexcelreader" target="_blank"><a href="http://sourceforge.net/projects/phpexcelreader">http://sourceforge.net/projects/phpexcelreader</a></a>，下载之后解压，主要用到excel文件夹里面的两个文件reader.php和oleread.php（这个文件默认的是oleread.inc，不清楚为啥，一堆e文，没看，直接改名即可）。</p>
<p>在reader.php文件中找到以下类似代码（第一行既是），改成正确的oleread.php路径即可：<code>require_once &#39;oleread.php&#39;;</code></p>
<p>然后新建一个php文件引入reader.php，
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/09/03/使用php把excelxls文件导入mysql数据库/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/08/22/通过php批量下载图片文件/">通过PHP批量下载图片文件</a></h1>
  

      <time datetime="2010-08-21T16:58:43.000Z"><a href="/2010/08/22/通过php批量下载图片文件/">2010年8月22日</a></time>
    </header>
    <div class="entry">
      
        <p>最近一直很忙，遇到一个手工活，需要下载一些远程的图片，一共一百多张，如果通过手工一张一张的保存，也太耗费时间了，于是上网google了一把，找到<strong>PHP批量下载图片</strong>文件的方法，原文是出自平凡世界博客的一片关于如何使用<strong>PHP</strong><a href="http://www.ccvita.com/375.html" target="_blank">批量下载CSS文件中的图片的文章</a>。经过研究改写了一下就可以使用了，方便快捷多了。</p>
<p>PHP批量下载图片文件代码：</p>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>
set_time_limit(<span class="number">0</span>);<span class="comment">//设置PHP超时时间</span>
<span class="variable">$imagesURLArray</span> = array_unique(<span class="variable">$imagesURLArray</span> );

<span class="keyword">foreach</span>(<span class="variable">$imagesURLArray</span> <span class="keyword">as</span> <span class="variable">$imagesURL</span>) {
    <span class="keyword">echo</span> <span class="variable">$imagesURL</span>;
    <span class="keyword">echo</span> <span class="string">"
"</span>;
    file_put_contents(basename(<span class="variable">$imagesURL</span>), file_get_contents(<span class="variable">$imagesURL</span>));
}
</pre></td></tr></table></figure>

<p>原理很简单，通过一个含有图片地址的数组循环，然后使用PHP的<strong>file_get_contents</strong>函数取得图片，在使用<strong>file_put_contents</strong>函数把图片保存下来。<br>P.S：一定要加上<strong>设置PHP超时时间</strong>哦~！<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/08/22/通过php批量下载图片文件/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/03/23/php获取来访者ip信息/">php获取来访者IP信息</a></h1>
  

      <time datetime="2010-03-22T21:25:34.000Z"><a href="/2010/03/23/php获取来访者ip信息/">2010年3月23日</a></time>
    </header>
    <div class="entry">
      
        <p>前几天幼学笔记写了一篇《<a href="http://www.oncoding.cn/2010/geo-location-frontend/" target="_blank">可以在前端实现的几个地理位置小功能</a>》里面提到了我使用的QQ ip接口，其实我们也可以在PHP端实现根据IP定位用户<strong>地理位置</strong>，方法就是根据纯真的IP库来获取IP地理信息。我一个<strong>Google map API</strong>逆经纬度查询结合IP数据库接口的demo<a href="http://js8.in/mywork/ipsearch/">[点击查看</a>]，其实使用的方法就是Ajax过去IP，通过QQ IP接口查询出来地理信息，然后调用Google map API逆经纬度查询经纬度信息，然后在Google地图上标注地理位置。</p>
<h3>1、PHP获取来访者IP函数getIP()</h3>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getIP</span><span class="params">()</span>
{</span> 
        <span class="keyword">if</span>(getenv(<span class="string">"HTTP_CLIENT_IP"</span>) && strcasecmp(getenv(<span class="string">"HTTP_CLIENT_IP"</span>), <span class="string">"unknown"</span>)) 
                <span class="variable">$ip</span> = getenv(<span class="string">"HTTP_CLIENT_IP"</span>); 
        <span class="keyword">elseif</span>(getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>) && strcasecmp(getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>), <span class="string">"unknown"</span>)) 
                <span class="variable">$ip</span> = getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>); 
        <span class="keyword">elseif</span> (getenv(<span class="string">"REMOTE_ADDR"</span>) && strcasecmp(getenv(<span class="string">"REMOTE_ADDR"</span>), <span class="string">"unknown"</span>)) 
                <span class="variable">$ip</span> = getenv(<span class="string">"REMOTE_ADDR"</span>); 
        <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]) && <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>] && strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>], <span class="string">"unknown"</span>)) 
                <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]; 
        <span class="keyword">else</span> 
                <span class="variable">$ip</span> = <span class="string">"0.0.0.0"</span>; 
        <span class="keyword">return</span> <span class="variable">$ip</span>;
}```&lt;!--more--&gt;

<span class="comment">### 2、查询纯真IP库PHP类IpLocation</span>


```php
<span class="class"><span class="keyword">class</span> <span class="title">IpLocation</span> {</span>
    <span class="comment">/**
     * QQWry.Dat文件指针
     *
     *<span class="phpdoc"> @var</span> resource
     */</span>
    <span class="keyword">var</span> <span class="variable">$fp</span>;
    <span class="comment">/**
    * 第一条IP记录的偏移地址
     *
    *<span class="phpdoc"> @var</span> int
       */</span>
       <span class="keyword">var</span> <span class="variable">$firstip</span>;
         <span class="comment">/**
        * 最后一条IP记录的偏移地址
        *
        *<span class="phpdoc"> @var</span> int
        */</span>
       <span class="keyword">var</span> <span class="variable">$lastip</span>;
        <span class="comment">/**
        * IP记录的总条数（不包含版本信息记录）
        *
        *<span class="phpdoc"> @var</span> int
        */</span>
       <span class="keyword">var</span> <span class="variable">$totalip</span>;
         <span class="comment">/**
        * 返回读取的长整型数
        *
       *<span class="phpdoc"> @access</span> private
        *<span class="phpdoc"> @return</span> int
        */</span>
       <span class="function"><span class="keyword">function</span> <span class="title">getlong</span><span class="params">()</span> {</span>
           <span class="comment">//将读取的little-endian编码的4个字节转化为长整型数</span>
           <span class="variable">$result</span> = unpack(<span class="string">'Vlong'</span>, fread(<span class="variable">$this</span>-&gt;fp, <span class="number">4</span>));
           <span class="keyword">return</span> <span class="variable">$result</span>[<span class="string">'long'</span>];
       }
         <span class="comment">/**
        * 返回读取的3个字节的长整型数
        *
        *<span class="phpdoc"> @access</span> private
        *<span class="phpdoc"> @return</span> int
       */</span>
       <span class="function"><span class="keyword">function</span> <span class="title">getlong3</span><span class="params">()</span> {</span>
           <span class="comment">//将读取的little-endian编码的3个字节转化为长整型数</span>
           <span class="variable">$result</span> = unpack(<span class="string">'Vlong'</span>, fread(<span class="variable">$this</span>-&gt;fp, <span class="number">3</span>).chr(<span class="number">0</span>));
           <span class="keyword">return</span> <span class="variable">$result</span>[<span class="string">'long'</span>];
       }
    <span class="comment">/**
     * 返回压缩后可进行比较的IP地址
     *
       *<span class="phpdoc"> @access</span> private
        *<span class="phpdoc"> @param</span> string $ip
        *<span class="phpdoc"> @return</span> string
        */</span>
       <span class="function"><span class="keyword">function</span> <span class="title">packip</span><span class="params">(<span class="variable">$ip</span>)</span> {</span>
           <span class="comment">// 将IP地址转化为长整型数，如果在PHP5中，IP地址错误，则返回False，</span>
        <span class="comment">// 这时intval将Flase转化为整数-1，之后压缩成big-endian编码的字符串</span>
        <span class="keyword">return</span> pack(<span class="string">'N'</span>, intval(ip2long(<span class="variable">$ip</span>)));
    }
    <span class="comment">/**
     * 返回读取的字符串
        *
        *<span class="phpdoc"> @access</span> private
        *<span class="phpdoc"> @param</span> string $data
        *<span class="phpdoc"> @return</span> string
     */</span>
    <span class="function"><span class="keyword">function</span> <span class="title">getstring</span><span class="params">(<span class="variable">$data</span> = <span class="string">""</span>)</span> {</span>
        <span class="variable">$char</span> = fread(<span class="variable">$this</span>-&gt;fp, <span class="number">1</span>);
        <span class="keyword">while</span> (ord(<span class="variable">$char</span>) &gt; <span class="number">0</span>) {        <span class="comment">// 字符串按照C格式保存，以\0结束</span>
            <span class="variable">$data</span> .= <span class="variable">$char</span>;             <span class="comment">// 将读取的字符连接到给定字符串之后</span>
            <span class="variable">$char</span> = fread(<span class="variable">$this</span>-&gt;fp, <span class="number">1</span>);
        }
           <span class="keyword">return</span> <span class="variable">$data</span>;
       }
      <span class="comment">/**
     * 返回地区信息
     *
     *<span class="phpdoc"> @access</span> private
     *<span class="phpdoc"> @return</span> string
     */</span>
    <span class="function"><span class="keyword">function</span> <span class="title">getarea</span><span class="params">()</span> {</span>
        <span class="variable">$byte</span> = fread(<span class="variable">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span>
           <span class="keyword">switch</span> (ord(<span class="variable">$byte</span>)) {
            <span class="keyword">case</span> <span class="number">0</span>:                     <span class="comment">// 没有区域信息</span>
                 <span class="variable">$area</span> = <span class="string">""</span>;
                 <span class="keyword">break</span>;
             <span class="keyword">case</span> <span class="number">1</span>:
             <span class="keyword">case</span> <span class="number">2</span>:                     <span class="comment">// 标志字节为1或2，表示区域信息被重定向</span>
                 fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$this</span>-&gt;getlong3());
                 <span class="variable">$area</span> = <span class="variable">$this</span>-&gt;getstring();
                 <span class="keyword">break</span>;
             <span class="keyword">default</span>:                    <span class="comment">// 否则，表示区域信息没有被重定向</span>
                 <span class="variable">$area</span> = <span class="variable">$this</span>-&gt;getstring(<span class="variable">$byte</span>);
                <span class="keyword">break</span>;
        }
        <span class="keyword">return</span> <span class="variable">$area</span>;
    }
    <span class="comment">/**
     * 根据所给 IP 地址或域名返回所在地区信息
     *
     *<span class="phpdoc"> @access</span> public
     *<span class="phpdoc"> @param</span> string $ip
     *<span class="phpdoc"> @return</span> array
      */</span>
    <span class="function"><span class="keyword">function</span> <span class="title">getlocation</span><span class="params">(<span class="variable">$ip</span>)</span> {</span>
        <span class="keyword">if</span> (!<span class="variable">$this</span>-&gt;fp) <span class="keyword">return</span> <span class="keyword">null</span>;            <span class="comment">// 如果数据文件没有被正确打开，则直接返回空</span>
        <span class="variable">$location</span>[<span class="string">'ip'</span>] = gethostbyname(<span class="variable">$ip</span>);   <span class="comment">// 将输入的域名转化为IP地址</span>
        <span class="variable">$ip</span> = <span class="variable">$this</span>-&gt;packip(<span class="variable">$location</span>[<span class="string">'ip'</span>]);   <span class="comment">// 将输入的IP地址转化为可比较的IP地址</span>
                                               <span class="comment">// 不合法的IP地址会被转化为255</span>
        <span class="comment">// 对分搜索</span>
        <span class="variable">$l</span> = <span class="number">0</span>;                         <span class="comment">// 搜索的下边界</span>
        <span class="variable">$u</span> = <span class="variable">$this</span>-&gt;totalip;            <span class="comment">// 搜索的上边界</span>
        <span class="variable">$findip</span> = <span class="variable">$this</span>-&gt;lastip;        <span class="comment">// 如果没有找到就返回最后一条IP记录（QQWry.Dat的版本信息）</span>
         <span class="keyword">while</span> (<span class="variable">$l</span> &lt;= <span class="variable">$u</span>) {              <span class="comment">// 当上边界小于下边界时，查找失败</span>
             <span class="variable">$i</span> = floor((<span class="variable">$l</span> + <span class="variable">$u</span>) / <span class="number">2</span>);  <span class="comment">// 计算近似中间记录</span>
            fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$this</span>-&gt;firstip + <span class="variable">$i</span> * <span class="number">7</span>);
            <span class="variable">$beginip</span> = strrev(fread(<span class="variable">$this</span>-&gt;fp, <span class="number">4</span>));     <span class="comment">// 获取中间记录的开始IP地址</span>
            <span class="comment">// strrev函数在这里的作用是将little-endian的压缩IP地址转化为big-endian的格式</span>
            <span class="comment">// 以便用于比较，后面相同。</span>
            <span class="keyword">if</span> (<span class="variable">$ip</span> &lt; <span class="variable">$beginip</span>) {       <span class="comment">// 用户的IP小于中间记录的开始IP地址时</span>
                <span class="variable">$u</span> = <span class="variable">$i</span> - <span class="number">1</span>;            <span class="comment">// 将搜索的上边界修改为中间记录减一</span>
            }
            <span class="keyword">else</span> {
                 fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$this</span>-&gt;getlong3());
                 <span class="variable">$endip</span> = strrev(fread(<span class="variable">$this</span>-&gt;fp, <span class="number">4</span>));   <span class="comment">// 获取中间记录的结束IP地址</span>
                 <span class="keyword">if</span> (<span class="variable">$ip</span> &gt; <span class="variable">$endip</span>) {     <span class="comment">// 用户的IP大于中间记录的结束IP地址时</span>
                    <span class="variable">$l</span> = <span class="variable">$i</span> + <span class="number">1</span>;        <span class="comment">// 将搜索的下边界修改为中间记录加一</span>
                }
                <span class="keyword">else</span> {                  <span class="comment">// 用户的IP在中间记录的IP范围内时</span>
                    <span class="variable">$findip</span> = <span class="variable">$this</span>-&gt;firstip + <span class="variable">$i</span> * <span class="number">7</span>;
                    <span class="keyword">break</span>;              <span class="comment">// 则表示找到结果，退出循环</span>
                }
            }
         }
         <span class="comment">//获取查找到的IP地理位置信息</span>
         fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$findip</span>);
         <span class="variable">$location</span>[<span class="string">'beginip'</span>] = long2ip(<span class="variable">$this</span>-&gt;getlong());   <span class="comment">// 用户IP所在范围的开始地址</span>
        <span class="variable">$offset</span> = <span class="variable">$this</span>-&gt;getlong3();
        fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$offset</span>);
        <span class="variable">$location</span>[<span class="string">'endip'</span>] = long2ip(<span class="variable">$this</span>-&gt;getlong());     <span class="comment">// 用户IP所在范围的结束地址</span>
        <span class="variable">$byte</span> = fread(<span class="variable">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span>
        <span class="keyword">switch</span> (ord(<span class="variable">$byte</span>)) {
             <span class="keyword">case</span> <span class="number">1</span>:                     <span class="comment">// 标志字节为1，表示国家和区域信息都被同时重定向</span>
                 <span class="variable">$countryOffset</span> = <span class="variable">$this</span>-&gt;getlong3();         <span class="comment">// 重定向地址</span>
                 fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$countryOffset</span>);
                 <span class="variable">$byte</span> = fread(<span class="variable">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span>
                 <span class="keyword">switch</span> (ord(<span class="variable">$byte</span>)) {
                    <span class="keyword">case</span> <span class="number">2</span>:             <span class="comment">// 标志字节为2，表示国家信息又被重定向</span>
                        fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$this</span>-&gt;getlong3());
                        <span class="variable">$location</span>[<span class="string">'country'</span>] = <span class="variable">$this</span>-&gt;getstring();
                        fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$countryOffset</span> + <span class="number">4</span>);
                        <span class="variable">$location</span>[<span class="string">'area'</span>] = <span class="variable">$this</span>-&gt;getarea();
                         <span class="keyword">break</span>;
                     <span class="keyword">default</span>:            <span class="comment">// 否则，表示国家信息没有被重定向</span>
                         <span class="variable">$location</span>[<span class="string">'country'</span>] = <span class="variable">$this</span>-&gt;getstring(<span class="variable">$byte</span>);
                         <span class="variable">$location</span>[<span class="string">'area'</span>] = <span class="variable">$this</span>-&gt;getarea();
                         <span class="keyword">break</span>;
                 }
                <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">2</span>:                     <span class="comment">// 标志字节为2，表示国家信息被重定向</span>
                fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$this</span>-&gt;getlong3());
                <span class="variable">$location</span>[<span class="string">'country'</span>] = <span class="variable">$this</span>-&gt;getstring();
                 fseek(<span class="variable">$this</span>-&gt;fp, <span class="variable">$offset</span> + <span class="number">8</span>);
                 <span class="variable">$location</span>[<span class="string">'area'</span>] = <span class="variable">$this</span>-&gt;getarea();
                 <span class="keyword">break</span>;
             <span class="keyword">default</span>:                    <span class="comment">// 否则，表示国家信息没有被重定向</span>
                 <span class="variable">$location</span>[<span class="string">'country'</span>] = <span class="variable">$this</span>-&gt;getstring(<span class="variable">$byte</span>);
                 <span class="variable">$location</span>[<span class="string">'area'</span>] = <span class="variable">$this</span>-&gt;getarea();
                 <span class="keyword">break</span>;
        }
        <span class="keyword">if</span> (<span class="variable">$location</span>[<span class="string">'country'</span>] == <span class="string">" CZNET"</span>) {  <span class="comment">// CZNET表示没有有效信息</span>
            <span class="variable">$location</span>[<span class="string">'country'</span>] = <span class="string">"未知"</span>;
         }
         <span class="keyword">if</span> (<span class="variable">$location</span>[<span class="string">'area'</span>] == <span class="string">" CZNET"</span>) {
             <span class="variable">$location</span>[<span class="string">'area'</span>] = <span class="string">""</span>;
         }
         <span class="keyword">return</span> <span class="variable">$location</span>;
     }
     <span class="comment">/**
     * 构造函数，打开 QQWry.Dat 文件并初始化类中的信息
     *
       *<span class="phpdoc"> @param</span> string $filename
       *<span class="phpdoc"> @return</span> IpLocation
       */</span>
      <span class="function"><span class="keyword">function</span> <span class="title">IpLocation</span><span class="params">(<span class="variable">$filename</span> = <span class="string">"QQWry.Dat"</span>)</span> {</span>
          <span class="variable">$this</span>-&gt;fp = <span class="number">0</span>;
          <span class="keyword">if</span> ((<span class="variable">$this</span>-&gt;fp = @fopen(<span class="variable">$filename</span>, <span class="string">'rb'</span>)) !== <span class="keyword">false</span>) {
              <span class="variable">$this</span>-&gt;firstip = <span class="variable">$this</span>-&gt;getlong();
              <span class="variable">$this</span>-&gt;lastip = <span class="variable">$this</span>-&gt;getlong();
              <span class="variable">$this</span>-&gt;totalip = (<span class="variable">$this</span>-&gt;lastip - <span class="variable">$this</span>-&gt;firstip) / <span class="number">7</span>;
           <span class="comment">//注册析构函数，使其在程序执行结束时执行</span>
           register_shutdown_function(<span class="keyword">array</span>(&<span class="variable">$this</span>, <span class="string">'_IpLocation'</span>));
       }
   }
   <span class="comment">/**
    * 析构函数，用于在页面执行结束后自动关闭打开的文件。
    *
    */</span>
   <span class="function"><span class="keyword">function</span> <span class="title">_IpLocation</span><span class="params">()</span> {</span>
       <span class="keyword">if</span> (<span class="variable">$this</span>-&gt;fp) {
              fclose(<span class="variable">$this</span>-&gt;fp);
        }
        <span class="variable">$this</span>-&gt;fp = <span class="number">0</span>;
   }
}
</pre></td></tr></table></figure>

<h3>3、使用方法</h3>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="variable">$ip</span>=getIP();
<span class="variable">$iplocation</span> = <span class="keyword">new</span> IpLocation();
<span class="variable">$location</span> = <span class="variable">$iplocation</span>-&gt;getlocation(<span class="variable">$ip</span>);
<span class="comment">//转码为UTF-8</span>
<span class="variable">$address</span>=mb_convert_encoding(<span class="variable">$location</span>[<span class="string">'country'</span>].<span class="variable">$location</span>[<span class="string">'area'</span>], <span class="string">"UTF-8"</span>, <span class="string">"GBK"</span>);
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/02/05/php二维数组去重复项函数/">PHP二维数组去重复项函数</a></h1>
  

      <time datetime="2010-02-05T08:42:15.000Z"><a href="/2010/02/05/php二维数组去重复项函数/">2010年2月5日</a></time>
    </header>
    <div class="entry">
      
        <p>PHP数组去除<strong>重复项</strong>有个内置函数<strong>array_unique</strong>()，但是php的array_unique函数只适用于一维数组，对多维数组并不适用，以下提供一个<strong>二维数组</strong>的array_unique函数</p>
<blockquote>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="comment">//二维数组去掉重复值</span>
&gt; <span class="function"><span class="keyword">function</span> <span class="title">array_unique_fb</span><span class="params">(<span class="variable">$array2D</span>)</span>{</span>
&gt;      <span class="keyword">foreach</span> (<span class="variable">$array2D</span> <span class="keyword">as</span> <span class="variable">$v</span>){
&gt;          <span class="variable">$v</span> = join(<span class="string">","</span>,<span class="variable">$v</span>);  <span class="comment">//降维,也可以用implode,将一维数组转换为用逗号连接的字符串</span>
&gt;          <span class="variable">$temp</span>[] = <span class="variable">$v</span>;
&gt;      }
&gt;      <span class="variable">$temp</span> = array_unique(<span class="variable">$temp</span>);    <span class="comment">//去掉重复的字符串,也就是重复的一维数组</span>
&gt;     <span class="keyword">foreach</span> (<span class="variable">$temp</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>){
&gt;         <span class="variable">$temp</span>[<span class="variable">$k</span>] = explode(<span class="string">","</span>,<span class="variable">$v</span>);   <span class="comment">//再将拆开的数组重新组装</span>
&gt;     }
&gt;     <span class="keyword">return</span> <span class="variable">$temp</span>;
&gt; }
</pre></td></tr></table></figure>

</blockquote>

      
    </div>
    <footer>
      
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2010/01/19/21个常用的-php-代码汇总/">21个常用的 PHP 代码汇总</a></h1>
  

      <time datetime="2010-01-19T11:50:08.000Z"><a href="/2010/01/19/21个常用的-php-代码汇总/">2010年1月19日</a></time>
    </header>
    <div class="entry">
      
        <p><strong>PHP</strong> 是目前使用最广泛的基于 Web 的编程语言，驱动着数以百万计的网站，其中也包括如 Facebook 等一些大型站点。这里收集了 21个日常开发中实用便捷的 PHP 代码，希望可以对一些 PHP 开发者都会有所帮助。</p>
<h3>1. 可阅读随机字符串</h3>
<p>此代码将创建一个可阅读的字符串，使其更接近词典中的单词，实用且具有密码验证功能。</p>
<blockquote>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre>
&gt; <span class="comment">/**************
&gt; *@length - length of random string (must be a multiple of 2)
&gt; **************/</span>
&gt; <span class="function"><span class="keyword">function</span> <span class="title">readable_random_string</span><span class="params">(<span class="variable">$length</span> = <span class="number">6</span>)</span>{</span>
&gt;     <span class="variable">$conso</span>=<span class="keyword">array</span>(<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"f"</span>,<span class="string">"g"</span>,<span class="string">"h"</span>,<span class="string">"j"</span>,<span class="string">"k"</span>,<span class="string">"l"</span>,
&gt;     <span class="string">"m"</span>,<span class="string">"n"</span>,<span class="string">"p"</span>,<span class="string">"r"</span>,<span class="string">"s"</span>,<span class="string">"t"</span>,<span class="string">"v"</span>,<span class="string">"w"</span>,<span class="string">"x"</span>,<span class="string">"y"</span>,<span class="string">"z"</span>);
&gt;     <span class="variable">$vocal</span>=<span class="keyword">array</span>(<span class="string">"a"</span>,<span class="string">"e"</span>,<span class="string">"i"</span>,<span class="string">"o"</span>,<span class="string">"u"</span>);
&gt;     <span class="variable">$password</span>=<span class="string">""</span>;
&gt;     srand ((double)microtime()*<span class="number">1000000</span>);
&gt;     <span class="variable">$max</span> = <span class="variable">$length</span>/<span class="number">2</span>;
&gt;     <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span>&lt;=<span class="variable">$max</span>; <span class="variable">$i</span>++)
&gt;     {
&gt;     <span class="variable">$password</span>.=<span class="variable">$conso</span>[rand(<span class="number">0</span>,<span class="number">19</span>)];
&gt;     <span class="variable">$password</span>.=<span class="variable">$vocal</span>[rand(<span class="number">0</span>,<span class="number">4</span>)];
&gt;     }
&gt;     <span class="keyword">return</span> <span class="variable">$password</span>;
&gt; }
</pre></td></tr></table></figure>

</blockquote>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/01/19/21个常用的-php-代码汇总/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2009/12/31/三个使用wordpress自定义域做的小工具/">三个使用WordPress自定义域做的小工具</a></h1>
  

      <time datetime="2009-12-31T08:26:10.000Z"><a href="/2009/12/31/三个使用wordpress自定义域做的小工具/">2009年12月31日</a></time>
    </header>
    <div class="entry">
      
        <p>刚开始建立WordPress博客的时候对于自定义域不是很了解，之后通过搜索相关知识：发现原来<strong>WordPress自定义域</strong>可以做很多事情，今天断桥残雪就说说WordPress自定义域三个用处：<strong>给某一日记添加js或者CSS</strong>，<strong>给加密的日志添加密码提示信息</strong>、<strong>首页显示日志缩略图</strong>。</p>
<h3>给某一日记添加js或者CSS</h3>
<p>WordPress 在发布日志时会对过滤一些Javascript、CSS内容，所以我们无法直接把JS、CSS直接写到日志，当然我们可以通过修改主题来实现。可是如果修改主题，把JS或者CSS的内容添加到 header.php 文件中，那么博客所有的页面都会加载这些内容，这样势必会造成整个博客效率下降。所以这个时候我们可以通过 WordPress 自定义域来给某篇的日志单独加<strong>载Javascript 和CSS</strong>。文章最后再介绍一种管理WordPress自定义域的小技巧工具。</p>
<p>假设我们给日志单独加载JS、CSS的自定义域名称是 head_JS_CSS。那么你首先需要把下面这段代码复制到你主题根目录下的 functions.php 文件中：</p>
<blockquote>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>
&gt; <span class="function"><span class="keyword">function</span> <span class="title">head_JS_CSS</span><span class="params">()</span>{</span>
&gt;     <span class="keyword">if</span> (is_single() || is_page()) {
&gt;         <span class="keyword">global</span> <span class="variable">$post</span>;
&gt;         <span class="variable">$head_JS_CSS</span> = get_post_meta(<span class="variable">$post</span>-&gt;ID, <span class="string">'head_JS_CSS'</span>, <span class="keyword">true</span>);
&gt;         <span class="keyword">echo</span> <span class="variable">$head_JS_CSS</span>;
&gt;     }
&gt; }
&gt; add_action(<span class="string">"wp_head"</span>,<span class="string">"head_JS_CSS"</span>);
</pre></td></tr></table></figure>

</blockquote>
<p>现在你在添加日志的时候，在WordPress自定义域区域，创建一个新的名称为：&quot;head_JS_CSS&quot;自定义域，在“值”输入你要单独为这篇日志加载的 Javascript 代码或者 CSS 即可。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2009/12/31/三个使用wordpress自定义域做的小工具/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2009/12/25/php生成rss类：rss-class-php/">PHP生成RSS类：RSS.class.php</a></h1>
  

      <time datetime="2009-12-25T12:33:02.000Z"><a href="/2009/12/25/php生成rss类：rss-class-php/">2009年12月25日</a></time>
    </header>
    <div class="entry">
      
        <p>前些日子给<a href="http://love.2fool.cn" target="_blank">爱墙</a>添加了RSS订阅功能，代码是自己写的，其中使用到了一个PHP类：RSS.class.php，感觉非常方便，不敢独享，特拿出来跟大家分享。</p>
<p>使用方法如下：</blockquote><br>使用方法如下：</p>
<blockquote>
<figure class="highlight lang-php"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>
&gt; <span class="keyword">include_once</span>(<span class="string">"class/RSS.class.php"</span>);<span class="comment">//引入RSS PHP类</span>
&gt; <span class="variable">$RSS</span>= <span class="keyword">new</span> RSS(<span class="string">"名称"</span>,<span class="string">"地址"</span>,<span class="string">"描述"</span>,<span class="string">"RSS频道图标"</span>);
&gt; <span class="variable">$RSS</span>-&gt;AddItem(<span class="string">"日志的标题"</span>,<span class="string">"日志的地址"</span>,<span class="string">"日志的摘要"</span>,<span class="string">"日志的发布日期"</span>);
&gt; <span class="variable">$RSS</span>-&gt;Display();<span class="comment">//输出RSS内容</span>
</pre></td></tr></table></figure>

</blockquote>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2009/12/25/php生成rss类：rss-class-php/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
      
      
  
    <h1 class="title"><a href="/2009/12/14/curl常用的几个php函数/">cURL常用的几个PHP函数</a></h1>
  

      <time datetime="2009-12-14T09:26:11.000Z"><a href="/2009/12/14/curl常用的几个php函数/">2009年12月14日</a></time>
    </header>
    <div class="entry">
      
        <p>cURL是一个功能强大的<strong>PHP库</strong>，我们可以使用PHP的cURL采用<strong>GET</strong>、<strong>POST</strong>等方式发送请求，获取网页内容以及取一个XML文件并把其导入数据库等等。本文中收集了几种常用的<strong>PHP的cURL函数</strong>，以备使用。主要的有几个PHP函数用于：GET，POST，HTTP验证，<strong>302重定向</strong>，设置cURL的代理。</p>
<h3>1、开启PHP的cURL功能</h3>
<p>在Windows平台下，或者使用xampp之类的集成服务器的程序，会非常简单，你需要改一改你的<strong>php.ini</strong>文件的设置，找到php_curl.dll，并取消前面的分号注释就行了。如下所示：</p>
<blockquote>
<p>//取消注释，开启cURL功能<br>extension=php_curl.dll<br>在<strong>Linux</strong>下面，那么，你需要重新编译你的PHP了，编辑时，你需要打开编译参数——在configure命令上加上“–with-curl” 参数。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2009/12/14/curl常用的几个php函数/#more" class="more-link">全文</a>
          </div>
        
        
      
      

      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/乱七八糟/">乱七八糟</a><small>30</small></li>
  
    <li><a href="/categories/前端开发/">前端开发</a><small>117</small></li>
  
    <li><a href="/categories/后端运维/">后端运维</a><small>27</small></li>
  
    <li><a href="/categories/王婆卖瓜/">王婆卖瓜</a><small>4</small></li>
  
    <li><a href="/categories/读书笔记/">读书笔记</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签</h3>
  <ul class="entry clearfix">
  
    <li><a href="/tags/DOM/">DOM<sup>2</sup></a></li>
  
    <li><a href="/tags/IE/">IE<sup>1</sup></a></li>
  
    <li><a href="/tags/IE6/">IE6<sup>2</sup></a></li>
  
    <li><a href="/tags/PPT/">PPT<sup>3</sup></a></li>
  
    <li><a href="/tags/VPS/">VPS<sup>1</sup></a></li>
  
    <li><a href="/tags/ajax/">ajax<sup>5</sup></a></li>
  
    <li><a href="/tags/apache/">apache<sup>1</sup></a></li>
  
    <li><a href="/tags/audio/">audio<sup>2</sup></a></li>
  
    <li><a href="/tags/a标签/">a标签<sup>1</sup></a></li>
  
    <li><a href="/tags/canvas/">canvas<sup>1</sup></a></li>
  
    <li><a href="/tags/chrome/">chrome<sup>3</sup></a></li>
  
    <li><a href="/tags/css/">css<sup>15</sup></a></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator<sup>1</sup></a></li>
  
    <li><a href="/tags/ecmascript/">ecmascript<sup>3</sup></a></li>
  
    <li><a href="/tags/escape/">escape<sup>1</sup></a></li>
  
    <li><a href="/tags/event/">event<sup>1</sup></a></li>
  
    <li><a href="/tags/express/">express<sup>1</sup></a></li>
  
    <li><a href="/tags/fis/">fis<sup>1</sup></a></li>
  
    <li><a href="/tags/fisp/">fisp<sup>1</sup></a></li>
  
    <li><a href="/tags/grunt/">grunt<sup>1</sup></a></li>
  
    <li><a href="/tags/handleEvent/">handleEvent<sup>1</sup></a></li>
  
    <li><a href="/tags/html5/">html5<sup>3</sup></a></li>
  
    <li><a href="/tags/iframe/">iframe<sup>1</sup></a></li>
  
    <li><a href="/tags/iptables/">iptables<sup>1</sup></a></li>
  
    <li><a href="/tags/javascript/">javascript<sup>79</sup></a></li>
  
    <li><a href="/tags/linux/">linux<sup>4</sup></a></li>
  
    <li><a href="/tags/livereload/">livereload<sup>1</sup></a></li>
  
    <li><a href="/tags/memcached/">memcached<sup>1</sup></a></li>
  
    <li><a href="/tags/mixjs/">mixjs<sup>1</sup></a></li>
  
    <li><a href="/tags/mysql/">mysql<sup>2</sup></a></li>
  
    <li><a href="/tags/name/">name<sup>1</sup></a></li>
  
    <li><a href="/tags/nginx/">nginx<sup>2</sup></a></li>
  
    <li><a href="/tags/nodejs/">nodejs<sup>7</sup></a></li>
  
    <li><a href="/tags/php/">php<sup>19</sup></a></li>
  
    <li><a href="/tags/session/">session<sup>1</sup></a></li>
  
    <li><a href="/tags/storage/">storage<sup>1</sup></a></li>
  
    <li><a href="/tags/svn/">svn<sup>1</sup></a></li>
  
    <li><a href="/tags/this/">this<sup>1</sup></a></li>
  
    <li><a href="/tags/ueditor/">ueditor<sup>1</sup></a></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs<sup>1</sup></a></li>
  
    <li><a href="/tags/webbench/">webbench<sup>1</sup></a></li>
  
    <li><a href="/tags/websocket/">websocket<sup>1</sup></a></li>
  
    <li><a href="/tags/web前端开发/">web前端开发<sup>5</sup></a></li>
  
    <li><a href="/tags/windows7技巧/">windows7技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/wordpress/">wordpress<sup>3</sup></a></li>
  
    <li><a href="/tags/xss/">xss<sup>3</sup></a></li>
  
    <li><a href="/tags/严格模式/">严格模式<sup>1</sup></a></li>
  
    <li><a href="/tags/位运算/">位运算<sup>1</sup></a></li>
  
    <li><a href="/tags/作用域/">作用域<sup>3</sup></a></li>
  
    <li><a href="/tags/前端优化/">前端优化<sup>1</sup></a></li>
  
    <li><a href="/tags/前端工具/">前端工具<sup>5</sup></a></li>
  
    <li><a href="/tags/加速器/">加速器<sup>1</sup></a></li>
  
    <li><a href="/tags/压力测试/">压力测试<sup>1</sup></a></li>
  
    <li><a href="/tags/右键/">右键<sup>1</sup></a></li>
  
    <li><a href="/tags/安全/">安全<sup>1</sup></a></li>
  
    <li><a href="/tags/性能/">性能<sup>3</sup></a></li>
  
    <li><a href="/tags/我也八卦/">我也八卦<sup>1</sup></a></li>
  
    <li><a href="/tags/执行环境/">执行环境<sup>1</sup></a></li>
  
    <li><a href="/tags/技巧/">技巧<sup>1</sup></a></li>
  
    <li><a href="/tags/播放器/">播放器<sup>1</sup></a></li>
  
    <li><a href="/tags/数组/">数组<sup>1</sup></a></li>
  
    <li><a href="/tags/标签/">标签<sup>1</sup></a></li>
  
    <li><a href="/tags/模块化/">模块化<sup>2</sup></a></li>
  
    <li><a href="/tags/算法/">算法<sup>1</sup></a></li>
  
    <li><a href="/tags/网络技术/">网络技术<sup>73</sup></a></li>
  
    <li><a href="/tags/虚拟主机/">虚拟主机<sup>1</sup></a></li>
  
    <li><a href="/tags/解耦/">解耦<sup>1</sup></a></li>
  
    <li><a href="/tags/语法限制/">语法限制<sup>1</sup></a></li>
  
    <li><a href="/tags/跨域/">跨域<sup>3</sup></a></li>
  
    <li><a href="/tags/路径/">路径<sup>1</sup></a></li>
  
    <li><a href="/tags/软件心得/">软件心得<sup>3</sup></a></li>
  
  </ul>
</div>



  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 三水清
  
</div>
<div class="clearfix"></div></footer>
  <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


    
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6635976" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
        </script>
    
    



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




    <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1c76f5cc8274a56106b13b9c9b1fb046' type='text/javascript'%3E%3C/script%3E"));
    </script>


</body>
</html>