title: "Hybrid APP开发：模板包管理平台"
date: 2017-04-19 09:38:35
tags:
- hybrid
- javascript
- 架构
categories:
- 前端开发
---

> 大上周文章提到了Hybrid的模板本地化解决方案，本文介绍下模板包的管理平台。

## 管理平台功能
模板包的管理平台主要功能包括：
1. 自动编译
2. 自动增量
3. 上传包
4. 推送下发
5. 提测
6. 小流量&灰度：按客户端id下发、小流量
7. 数据收集：收敛，速度，监控

<!--more-->

## 整体架构和流程图

![](/uploads/2017/04/11.jpg)

### 部分细节讲解

1. 通过git hook，当打tag的时候，会触发编译，编译完成后，会对接模板数据库，打出三个增量包（为什么三个，看「模板本地化」文章）
2. 回滚实际是重新拿上一个版本的全量包生成新的版本号和签名，然后入库
3. 模板包下发，可以根据客户端id（用户id）进行针对性下发，还可以根据IP地域、运营商、百分比等方式灰度下发，提测其实是定向的一种
4. 模板包下发日志和数据，都回传到日志系统，统一采集分析，生成数据报表
5. 模板收敛率统计有两种方法：
    1. 模板下发接口统计的当前版本号数据
    2. 模板代码请求业务方api获取数据，携带的模板版本号数据
    3. 这两种方式统计的收敛率数据不一样
6. 模板包失败统计是通过客户端上报的，可以详细列出哪个环节问题，比如是下载问题？解压问题？还是签名校验失败？